<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet author="Gerhard Maree" context="base" id="#4938 - Asset Management - Entites">
        <comment>Asset Status related changes</comment>
        <createTable tableName="asset_status">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="asset_status_pkey"/>
            </column>
            <column name="item_type_id" type="java.sql.Types.INTEGER" >
                <constraints nullable="true"/>
            </column>
            <column name="is_default" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="is_order_saved" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="is_available" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="item_type_id"
                                 baseTableName="asset_status" constraintName="asset_status_fk_1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item_type"
                                 referencesUniqueColumn="false" />
        <insert tableName="jbilling_seqs">
            <column name="name" value="asset_status"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
        <insert tableName="jbilling_table">
        	<column name="id"  valueComputed="(select max(jt.id)+1 from jbilling_table jt)"/>
            <column name="name" value="asset_status"/>
        </insert>

        <comment>Item related changes</comment>
        <addColumn tableName="item">
            <column name="asset_management_enabled" type="java.sql.Types.INTEGER" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
        </addColumn>

        <comment>ItemType related changes</comment>
        <createTable tableName="item_type_meta_field_def_map">
            <column name="item_type_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="meta_field_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="item_type_id"
                                 baseTableName="item_type_meta_field_def_map" constraintName="item_type_meta_field_def_map_fk_1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item_type"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="meta_field_id"
                                 baseTableName="item_type_meta_field_def_map" constraintName="item_type_meta_field_def_map_fk_2"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_name"
                                 referencesUniqueColumn="false" />
        <addColumn tableName="item_type">
            <column name="allow_asset_management" type="java.sql.Types.INTEGER" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
        </addColumn>
        <addColumn tableName="item_type">
            <column name="asset_identifier_label" type="java.sql.Types.VARCHAR(50)" />
        </addColumn>

        <comment>Asset related changes</comment>
        <createTable tableName="asset">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="asset_pkey"/>
            </column>
            <column name="identifier" type="java.sql.Types.VARCHAR(200)" >
                    <constraints nullable="false"/>
            </column>
            <column name="create_datetime" type="java.sql.Types.TIMESTAMP" >
                <constraints nullable="false"/>
            </column>
            <column name="status_id" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="entity_id" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="item_id" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="order_line_id" type="java.sql.Types.INTEGER" />
            <column name="notes" type="java.sql.Types.VARCHAR(1000)"/>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="entity_id"
                                 baseTableName="asset" constraintName="asset_fk_4"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="entity"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="status_id"
                                 baseTableName="asset" constraintName="asset_fk_3"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="asset_status"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="order_line_id"
                                 baseTableName="asset" constraintName="asset_fk_2"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_line"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="item_id"
                                 baseTableName="asset" constraintName="asset_fk_1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item"
                                 referencesUniqueColumn="false" />
        <insert tableName="jbilling_seqs">
            <column name="name" value="asset"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
        <insert tableName="jbilling_table">
        	<column name="id"  valueComputed="(select max(jt.id)+1 from jbilling_table jt)"/>
            <column name="name" value="asset"/>
        </insert>

        <createTable tableName="asset_meta_field_map">
            <column name="asset_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="meta_field_value_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="asset_id"
                                 baseTableName="asset_meta_field_map" constraintName="asset_meta_field_map_fk_1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="asset"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="meta_field_value_id"
                                 baseTableName="asset_meta_field_map" constraintName="asset_meta_field_map_fk_2"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_value"
                                 referencesUniqueColumn="false" />

        <comment>Asset Transition related changes</comment>
        <createTable tableName="asset_transition">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="asset_transition_pkey"/>
            </column>
            <column name="create_datetime" type="java.sql.Types.TIMESTAMP" >
                <constraints nullable="false"/>
            </column>
            <column name="previous_status_id" type="java.sql.Types.INTEGER" />
            <column name="new_status_id" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="asset_id" type="java.sql.Types.INTEGER" >
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="java.sql.Types.INTEGER" />
            <column name="assigned_to_id" type="java.sql.Types.INTEGER" />
        </createTable>
        <addForeignKeyConstraint baseColumnNames="assigned_to_id"
                                 baseTableName="asset_transition" constraintName="asset_transition_fk_1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="base_user"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="user_id"
                                 baseTableName="asset_transition" constraintName="asset_transition_fk_2"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="base_user"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="asset_id"
                                 baseTableName="asset_transition" constraintName="asset_transition_fk_3"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="asset"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="new_status_id"
                                 baseTableName="asset_transition" constraintName="asset_transition_fk_4"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="asset_status"
                                 referencesUniqueColumn="false" />
        <addForeignKeyConstraint baseColumnNames="previous_status_id"
                                 baseTableName="asset_transition" constraintName="asset_transition_fk_5"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="asset_status"
                                 referencesUniqueColumn="false" />
        <insert tableName="jbilling_seqs">
            <column name="name" value="asset_transition"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
        <insert tableName="jbilling_table">
        	<column name="id"  valueComputed="(select max(jt.id)+1 from jbilling_table jt)"/>
            <column name="name" value="asset_transition"/>
        </insert>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="#4938 - Asset Management - Pluggable Tasks">
        <comment>Register 3 new tasks:
            FileCleanupTask - This task will delete files older than a certain time. The task is only
                scheduled for the first entity since it will look at the same folder for all entities.
            AssetUpdatedTask - Create AssetTransitionDTO objects when asset status changes
            RemoveAssetFromFinishedOrderTask - When an Order moves into a FINISHED state all assets are
                unlinked and changed back to the default status
        </comment>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="coalesce((select max(p.id)+1 from pluggable_task_type p),1)"/>
            <column name="category_id" valueNumeric="22"/>
            <column name="class_name" value="com.sapienter.jbilling.server.pluggableTask.FileCleanupTask"/>
            <column name="min_parameters" valueNumeric="2"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Delete old files"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="This task will delete files older than a certain time."/>
        </insert>

        <sql>
            <![CDATA[
                   INSERT INTO pluggable_task (id, entity_id, type_id, processing_order, optlock)
                   select (select max(p.id)+1 from pluggable_task p) ,
                          e1.id,
                          (select max(p.id) from pluggable_task_type p),
                          4,
                          1
                   from entity e1
                   where e1.id in (select min(id) from entity);

                   INSERT INTO pluggable_task_parameter (id, task_id, name, str_value, optlock)
                   select (select max(pp.id)+1 from pluggable_task_parameter pp) ,
                          (select max(pt.id) from pluggable_task pt),
                          'folder.1',
                          '${base_dir}/reports/assets',
                          1
                   from entity e1
                   where e1.id in (select min(id) from entity);

                   INSERT INTO pluggable_task_parameter (id, task_id, name, str_value, optlock)
                   select (select max(pp.id)+1 from pluggable_task_parameter pp) ,
                          (select max(pt.id) from pluggable_task pt),
                          'file_name_regex.1',
                          'asset.*',
                          1
                   from entity e1
                   where e1.id in (select min(id) from entity);

                   INSERT INTO pluggable_task_parameter (id, task_id, name, int_value, optlock)
                   select (select max(pp.id)+1 from pluggable_task_parameter pp) ,
                          (select max(pt.id) from pluggable_task pt),
                          'age_in_minutes.1',
                          120,
                          1
                   from entity e1
                   where e1.id in (select min(id) from entity);
               ]]>
        </sql>

        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="coalesce((select max(p.id)+1 from pluggable_task_type p),1)"/>
            <column name="category_id" valueNumeric="17"/>
            <column name="class_name" value="com.sapienter.jbilling.server.item.tasks.AssetUpdatedTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Updates Asset Transitions"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="This plug-in will update AssetTransitions when an asset status changes."/>
        </insert>

        <sql>
            <![CDATA[
                   INSERT INTO pluggable_task (id, entity_id, type_id, processing_order, optlock)
                   select (select max(p.id)+1 from pluggable_task p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                          e1.id,
                          (select max(p.id) from pluggable_task_type p),
                          1,
                          1
                   from entity e1
                   order by e1.id
               ]]>
        </sql>

        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="coalesce((select max(p.id)+1 from pluggable_task_type p),1)"/>
            <column name="category_id" valueNumeric="17"/>
            <column name="class_name" value="com.sapienter.jbilling.server.item.tasks.RemoveAssetFromFinishedOrderTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Remove Assets From FINISHED Orders"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="This plug-in will remove Asset owners when the linked order expires."/>
        </insert>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="coalesce((select max(p.id)+1 from pluggable_task_type p),1)"/>
            <where>name='pluggable_task_type'</where>
        </update>

        <sql>
            <![CDATA[
                   INSERT INTO pluggable_task (id, entity_id, type_id, processing_order, optlock)
                   select (select max(p.id)+1 from pluggable_task p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                          e1.id,
                          (select max(p.id) from pluggable_task_type p),
                          1,
                          1
                   from entity e1
                   order by e1.id
               ]]>
        </sql>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="coalesce((select max(p.id)+1 from pluggable_task p), 1)"/>
            <where>name='pluggable_task'</where>
        </update>
    </changeSet>

    <changeSet author="Gerhard Maree" context="test" id="#4938 - Asset Management - Test data">
        <insert tableName="base_user">
            <column name="id" valueNumeric="5"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="password" value="6a204bd89f3c8348afd5c77c717a097a"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="status_id" valueNumeric="1"/>
            <column name="subscriber_status" valueNumeric="9"/>
            <column name="currency_id" valueNumeric="1"/>
            <column name="create_datetime" valueDate="2006-07-26T09:29:19.596"/>
            <column name="last_status_change"/>
            <column name="last_login"/>
            <column name="user_name" value="assetman"/>
            <column name="failed_attempts" valueNumeric="0"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        <insert tableName="customer">
            <column name="id" valueNumeric="5"/>
            <column name="user_id" valueNumeric="5"/>
            <column name="partner_id"/>
            <column name="referral_fee_paid"/>
            <column name="invoice_delivery_method_id" valueNumeric="1"/>
            <column name="notes"/>
            <column name="auto_payment_type" valueNumeric="1"/>
            <column name="due_date_unit_id"/>
            <column name="due_date_value"/>
            <column name="df_fm"/>
            <column name="parent_id"/>
            <column name="is_parent" valueNumeric="0"/>
            <column name="exclude_aging" valueNumeric="0"/>
            <column name="invoice_child" valueNumeric="0"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="balance_type" valueNumeric="1"/>
            <column name="dynamic_balance"/>
            <column name="credit_limit"/>
            <column name="auto_recharge"/>
            <column name="use_parent_pricing" valueBoolean="false"/>
            <column name="next_invoice_day_of_period" valueNumeric="1" />
            <column name="account_type_id" />
            <column name="invoice_design" />
            <column name="main_subscript_order_period_id"
                    valueComputed="(select distinct o.id from order_period o where 1 = o.entity_id and o.unit_id=1 and o.value=1) "/>
        </insert>
        <insert tableName="contact">
            <column name="id" valueNumeric="5"/>
            <column name="organization_name" value="Prancing Pony"/>
            <column name="street_addres1" value="1234 Great East Road"/>
            <column name="street_addres2" value=""/>
            <column name="city" value="Bree"/>
            <column name="state_province" value="Middle Earth"/>
            <column name="postal_code" value="54321"/>
            <column name="country_code" value="CA"/>
            <column name="last_name"/>
            <column name="first_name"/>
            <column name="person_initial"/>
            <column name="person_title"/>
            <column name="phone_country_code"/>
            <column name="phone_area_code" valueNumeric="123"/>
            <column name="phone_phone_number" value="321-1234"/>
            <column name="fax_country_code"/>
            <column name="fax_area_code"/>
            <column name="fax_phone_number"/>
            <column name="email" value="adminx@prancingpony.me"/>
            <column name="create_datetime" valueDate="2007-03-18T00:00:00.0"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="notification_include" valueNumeric="1"/>
            <column name="user_id" valueNumeric="5"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        <insert tableName="user_role_map">
            <column name="user_id" valueNumeric="5"/>
            <column name="role_id" valueNumeric="5"/>
        </insert>

        <insert tableName="item_type">
            <column name="id" valueNumeric="30"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="description" value="AllowAssetMgmt1"/>
            <column name="order_line_type_id" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="allow_asset_management" valueNumeric="0"/>
            <column name="internal" valueBoolean="false"/>
        </insert>
        <insert tableName="item_type">
            <column name="id" valueNumeric="31"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="description" value="AllowAssetMgmt2"/>
            <column name="order_line_type_id" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="allow_asset_management" valueNumeric="0"/>
            <column name="internal" valueBoolean="false"/>
        </insert>
        <insert tableName="item_type">
            <column name="id" valueNumeric="32"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="description" value="AllowAssetMgmt3"/>
            <column name="order_line_type_id" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="allow_asset_management" valueNumeric="1"/>
            <column name="internal" valueBoolean="false"/>
        </insert>
        <insert tableName="asset_status">
            <column name="id" valueNumeric="101"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="item_type_id" valueNumeric="32"/>
            <column name="is_default" valueNumeric="1"/>
            <column name="is_order_saved" valueNumeric="0"/>
            <column name="is_available" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        <insert tableName="asset_status">
            <column name="id" valueNumeric="102"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="item_type_id" valueNumeric="32"/>
            <column name="is_default" valueNumeric="0"/>
            <column name="is_order_saved" valueNumeric="1"/>
            <column name="is_available" valueNumeric="0"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        <insert tableName="asset_status">
            <column name="id" valueNumeric="103"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="item_type_id" valueNumeric="32"/>
            <column name="is_default" valueNumeric="0"/>
            <column name="is_order_saved" valueNumeric="0"/>
            <column name="is_available" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        <insert tableName="asset_status">
            <column name="id" valueNumeric="104"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="item_type_id" valueNumeric="32"/>
            <column name="is_default" valueNumeric="0"/>
            <column name="is_order_saved" valueNumeric="0"/>
            <column name="is_available" valueNumeric="0"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>

        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="AM3-MF1"/>
            <column name="entity_type" value="ASSET"/>
            <column name="data_type" value="INTEGER"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="false"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="Tax Exemption Code"/>
            <column name="entity_type" value="ASSET"/>
            <column name="data_type" value="LIST"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="false"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        <insert tableName="meta_field_value">
            <column name="id" valueNumeric="2119"/>
            <column name="meta_field_name_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
            <column name="dtype" value="list"/>
            <column name="boolean_value"/>
            <column name="date_value"/>
            <column name="decimal_value"/>
            <column name="integer_value"/>
            <column name="string_value" />
        </insert>
        <insert tableName="list_meta_field_values">
            <column name="meta_field_value_id" valueNumeric="2119"/>
            <column name="list_value" value="01"/>
        </insert>
        <update tableName="meta_field_name" >
            <column name="default_value_id" valueNumeric="2119" />
            <where>id=(select id from (select max(mn.id) as id from meta_field_name mn) as x)</where>
        </update>

        <insert tableName="item_type_meta_field_def_map">
            <column name="item_type_id" valueNumeric="32"/>
            <column name="meta_field_id" valueComputed="(select max(t.id)-1 from meta_field_name t)"/>
        </insert>
        <insert tableName="item_type_meta_field_def_map">
            <column name="item_type_id" valueNumeric="32"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>

        <insert tableName="item">
            <column name="id" valueNumeric="1250"/>
            <column name="internal_number" value="AM-1"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="percentage"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="has_decimals" valueNumeric="0"/>
            <column name="optlock" valueNumeric="2"/>
            <column name="gl_code" value="AM-1"/>
            <column name="asset_management_enabled" valueNumeric="1" />
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="14"/>
            <column name="foreign_id" valueNumeric="1250"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="AM-1"/>
        </insert>
        <insert tableName="item_type_map">
            <column name="item_id" valueNumeric="1250"/>
            <column name="type_id" valueNumeric="32"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="108"/>
            <column name="foreign_id" valueNumeric="101"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="DefaultStatus"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="108"/>
            <column name="foreign_id" valueNumeric="102"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="AddToOrderStatus"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="108"/>
            <column name="foreign_id" valueNumeric="103"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Available2"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="108"/>
            <column name="foreign_id" valueNumeric="104"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="UnAvailable2"/>
        </insert>
        <insert tableName="asset">
            <column name="id" valueNumeric="1"/>
            <column name="identifier" value="Asset1"/>
            <column name="create_datetime" valueDate="2013-01-09T14:41:51.208"/>
            <column name="status_id" valueNumeric="101"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="item_id" valueNumeric="1250"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>

        <insert tableName="meta_field_value">
            <column name="id" valueNumeric="2120"/>
            <column name="meta_field_name_id" valueComputed="(select max(t.id)-1 from meta_field_name t)"/>
            <column name="dtype" value="integer"/>
            <column name="boolean_value"/>
            <column name="date_value"/>
            <column name="decimal_value"/>
            <column name="integer_value" valueNumeric="12"/>
            <column name="string_value" />
        </insert>
        <insert tableName="meta_field_value">
            <column name="id" valueNumeric="2121"/>
            <column name="meta_field_name_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
            <column name="dtype" value="list"/>
            <column name="boolean_value"/>
            <column name="date_value"/>
            <column name="decimal_value"/>
            <column name="integer_value"/>
            <column name="string_value" />
        </insert>
        <insert tableName="list_meta_field_values">
            <column name="meta_field_value_id" valueNumeric="2121"/>
            <column name="list_value" value="01"/>
        </insert>
        <insert tableName="asset_meta_field_map">
            <column name="asset_id" valueNumeric="1"/>
            <column name="meta_field_value_id" valueNumeric="2120"/>
        </insert>
        <insert tableName="asset_meta_field_map">
            <column name="asset_id" valueNumeric="1"/>
            <column name="meta_field_value_id" valueNumeric="2121"/>
        </insert>

        <insert tableName="asset">
            <column name="id" valueNumeric="2"/>
            <column name="identifier" value="Asset2"/>
            <column name="create_datetime" valueDate="2013-01-09T14:41:51.208"/>
            <column name="status_id" valueNumeric="101"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="item_id" valueNumeric="1250"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        <insert tableName="meta_field_value">
            <column name="id" valueNumeric="2123"/>
            <column name="meta_field_name_id" valueComputed="(select max(t.id)-1 from meta_field_name t)"/>
            <column name="dtype" value="integer"/>
            <column name="boolean_value"/>
            <column name="date_value"/>
            <column name="decimal_value"/>
            <column name="integer_value" valueNumeric="10"/>
            <column name="string_value" />
        </insert>
        <insert tableName="meta_field_value">
            <column name="id" valueNumeric="2124"/>
            <column name="meta_field_name_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
            <column name="dtype" value="list"/>
            <column name="boolean_value"/>
            <column name="date_value"/>
            <column name="decimal_value"/>
            <column name="integer_value"/>
            <column name="string_value"/>
        </insert>
        <insert tableName="list_meta_field_values">
            <column name="meta_field_value_id" valueNumeric="2124"/>
            <column name="list_value" value="02"/>
        </insert>
        <insert tableName="asset_meta_field_map">
            <column name="asset_id" valueNumeric="2"/>
            <column name="meta_field_value_id" valueNumeric="2123"/>
        </insert>
        <insert tableName="asset_meta_field_map">
            <column name="asset_id" valueNumeric="2"/>
            <column name="meta_field_value_id" valueNumeric="2124"/>
        </insert>

        <insert tableName="asset">
            <column name="id" valueNumeric="3"/>
            <column name="identifier" value="Asset3"/>
            <column name="create_datetime" valueDate="2013-01-09T14:41:51.208"/>
            <column name="status_id" valueNumeric="101"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="item_id" valueNumeric="1250"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        <insert tableName="meta_field_value">
            <column name="id" valueNumeric="2125"/>
            <column name="meta_field_name_id" valueComputed="(select max(t.id)-1 from meta_field_name t)"/>
            <column name="dtype" value="integer"/>
            <column name="boolean_value"/>
            <column name="date_value"/>
            <column name="decimal_value"/>
            <column name="integer_value" valueNumeric="11"/>
            <column name="string_value"/>
        </insert>
        <insert tableName="meta_field_value">
            <column name="id" valueNumeric="2126"/>
            <column name="meta_field_name_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
            <column name="dtype" value="list"/>
            <column name="boolean_value"/>
            <column name="date_value"/>
            <column name="decimal_value"/>
            <column name="integer_value"/>
            <column name="string_value" />
        </insert>
        <insert tableName="list_meta_field_values">
            <column name="meta_field_value_id" valueNumeric="2126"/>
            <column name="list_value" value="03"/>
        </insert>
        <insert tableName="asset_meta_field_map">
            <column name="asset_id" valueNumeric="3"/>
            <column name="meta_field_value_id" valueNumeric="2125"/>
        </insert>
        <insert tableName="asset_meta_field_map">
            <column name="asset_id" valueNumeric="3"/>
            <column name="meta_field_value_id" valueNumeric="2126"/>
        </insert>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(t.id)+1 from asset t)"/>
            <where>name='asset'</where>
        </update>
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(t.id)+1 from asset_status t)"/>
            <where>name='asset_status'</where>
        </update>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="20130719 #5729: - Asset Groups - Entites">
        <comment>Asset Groups related changes</comment>

        <sql>
            <![CDATA[
            insert into asset_status (id, deleted, item_type_id, is_default, is_order_saved, is_available, optlock)
            select 100+id+(select next_id from jbilling_seqs where name='asset_status'), deleted, item_type_id, is_default, is_order_saved, is_available, 1
            from asset_status where id < 100;
            ]]>
        </sql>
        <update tableName="asset">
            <column name="status_id" valueComputed="100 + status_id + (select next_id from jbilling_seqs where name='asset_status')"/>
            <where>status_id &lt; 100</where>
        </update>
        <update tableName="asset_transition">
            <column name="new_status_id" valueComputed="100 + new_status_id + (select next_id from jbilling_seqs where name='asset_status')"/>
            <where>new_status_id &lt; 100</where>
        </update>
        <update tableName="asset_transition">
            <column name="previous_status_id" valueComputed="100 + previous_status_id + (select next_id from jbilling_seqs where name='asset_status')"/>
            <where>previous_status_id &lt; 100</where>
        </update>

        <update tableName="international_description">
            <column name="foreign_id" valueComputed="100 + foreign_id + (select next_id from jbilling_seqs where name='asset_status')"/>
            <where>table_id=108 AND foreign_id &lt; 100</where>
        </update>

        <delete tableName="asset_status">
            <where>id &lt; 100</where>
        </delete>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="coalesce((select max(p.id)+1 from asset_status p), 1)"/>
            <where>name='asset_status'</where>
        </update>

        <addColumn tableName="asset">
            <column name="group_id" type="java.sql.Types.INTEGER" />
        </addColumn>

        <addColumn tableName="asset_status">
            <column name="is_internal" type="java.sql.Types.INTEGER" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
        </addColumn>


        <insert tableName="asset_status">
            <column name="id" valueNumeric="1"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="is_default" valueNumeric="0"/>
            <column name="is_order_saved" valueNumeric="0"/>
            <column name="is_available" valueNumeric="0"/>
            <column name="is_internal" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="108"/>
            <column name="foreign_id" valueNumeric="1"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Member Of Group"/>
        </insert>

    </changeSet>

    <changeSet author="Emiliano Conde" id="spring-batch-tables">
        <comment>These are the tables and sequences needed by Spring Batch to work.
            Note that this will not work on MySQL, since it does not have sequences
            Yet S Batch does support MySQL so there has to be some alternative</comment>

        <createTable tableName="batch_job_execution">
            <column name="job_execution_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="batch_job_execution_pkey"/>
            </column>
            <column name="version" type="java.sql.Types.INTEGER"/>
            <column name="job_instance_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="create_time" type="java.sql.Types.TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="start_time" type="java.sql.Types.TIMESTAMP"/>
            <column name="end_time" type="java.sql.Types.TIMESTAMP"/>
            <column name="status" type="java.sql.Types.VARCHAR(10)"/>
            <column name="exit_code" type="java.sql.Types.VARCHAR(100)"/>
            <column name="exit_message" type="java.sql.Types.VARCHAR(2500)"/>
            <column name="last_updated" type="java.sql.Types.TIMESTAMP"/>
            <column name="job_configuration_location" type="java.sql.Types.VARCHAR(2500)" >
                <constraints nullable="true"/>
            </column>
        </createTable>

        <createTable tableName="batch_job_execution_context">
            <column name="job_execution_id" type="java.sql.Types.BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="batch_job_execution_context_pkey"/>
            </column>
            <column name="short_context" type="java.sql.Types.VARCHAR(2500)">
                <constraints nullable="false"/>
            </column>
            <column name="serialized_context" type="java.sql.Types.LONGVARCHAR"/>
        </createTable>

        <createTable tableName="batch_job_instance">
            <column name="job_instance_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="batch_job_instance_pkey"/>
            </column>
            <column name="version" type="java.sql.Types.INTEGER"/>
            <column name="job_name" type="java.sql.Types.VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="job_key" type="java.sql.Types.VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="batch_job_execution_params">
            <column name="job_execution_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="type_cd" type="java.sql.Types.VARCHAR(6)">
                <constraints nullable="false"/>
            </column>
            <column name="key_name" type="java.sql.Types.VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="string_val" type="java.sql.Types.VARCHAR(250)"/>
            <column name="date_val" type="java.sql.Types.TIMESTAMP"/>
            <column name="long_val" type="java.sql.Types.INTEGER"/>
            <column name="double_val" type="java.sql.Types.NUMERIC(17)"/>
            <column name="identifying" type="java.sql.Types.CHAR(1)"/>
        </createTable>

        <createTable tableName="batch_step_execution">
            <column name="step_execution_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="batch_step_execution_pkey"/>
            </column>
            <column name="version" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="step_name" type="java.sql.Types.VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="job_execution_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="start_time" type="java.sql.Types.TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="end_time" type="java.sql.Types.TIMESTAMP"/>
            <column name="status" type="java.sql.Types.VARCHAR(10)"/>
            <column name="commit_count" type="java.sql.Types.INTEGER"/>
            <column name="read_count" type="java.sql.Types.INTEGER"/>
            <column name="filter_count" type="java.sql.Types.INTEGER"/>
            <column name="write_count" type="java.sql.Types.INTEGER"/>
            <column name="read_skip_count" type="java.sql.Types.INTEGER"/>
            <column name="write_skip_count" type="java.sql.Types.INTEGER"/>
            <column name="process_skip_count" type="java.sql.Types.INTEGER"/>
            <column name="rollback_count" type="java.sql.Types.INTEGER"/>
            <column name="exit_code" type="java.sql.Types.VARCHAR(100)"/>
            <column name="exit_message" type="java.sql.Types.VARCHAR(2500)"/>
            <column name="last_updated" type="java.sql.Types.TIMESTAMP"/>
        </createTable>

        <createTable tableName="batch_step_execution_context">
            <column name="step_execution_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="batch_step_execution_context_pkey"/>
            </column>
            <column name="short_context" type="java.sql.Types.VARCHAR(2500)">
                <constraints nullable="false"/>
            </column>
            <column name="serialized_context" type="java.sql.Types.LONGVARCHAR"/>
        </createTable>

    </changeSet>

    <changeSet author="Gerhard Maree" id="spring-batch-key-gen-postgres" dbms="PostgreSQL,Oracle,MS-SQL">
        <preConditions onFail="MARK_RAN">
            <not>
            <sequenceExists sequenceName="batch_job_execution_seq"/>
            </not>
        </preConditions>
        <comment>These are the tables and sequences needed by Spring Batch to work on postgres.
        </comment>
        <createSequence cycle="false" incrementBy="1" sequenceName="batch_job_execution_seq" startValue="1"/>
        <createSequence cycle="false" incrementBy="1" sequenceName="batch_step_execution_seq" startValue="1"/>
        <createSequence cycle="false" incrementBy="1" sequenceName="batch_job_seq" startValue="1"/>
    </changeSet>

    <changeSet author="Gerhard Maree" id="spring-batch-key-gen-mysql" dbms="MySQL,hsqldb,h2">
        <preConditions onFail="MARK_RAN">
            <not>
            <tableExists tableName="batch_step_execution_seq"/>
            </not>
        </preConditions>
        <comment>These are the tables and sequences needed by Spring Batch to work on MySQL.
        </comment>
        <createTable tableName="batch_step_execution_seq">
            <column name="id" type="java.sql.Types.BIGINT" autoIncrement="true" incrementBy="1">
            	<constraints primaryKey="true"/>
            </column>
        </createTable>

        <createTable tableName="batch_job_seq">
            <column name="id" type="java.sql.Types.BIGINT" autoIncrement="true" incrementBy="1">
            	<constraints primaryKey="true"/>
            </column>
        </createTable>

        <createTable tableName="batch_job_execution_seq">
            <column name="id" type="java.sql.Types.BIGINT" autoIncrement="true" incrementBy="1">
            	<constraints primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet author="Rahul Asthana" id="Customer Account Type">
        <createTable tableName="account_type">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="account_type_pkey"/>
            </column>
            <column name="credit_limit" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="invoice_design" type="java.sql.Types.VARCHAR(100)"/>
            <column name="invoice_delivery_method_id" type="java.sql.Types.INTEGER"/>
            <column name="date_created" type="java.sql.Types.TIMESTAMP"/>
            <column name="credit_notification_limit1" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="credit_notification_limit2" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="language_id" type="java.sql.Types.INTEGER"/>
            <column name="entity_id" type="java.sql.Types.INTEGER"/>
            <column name="currency_id" type="java.sql.Types.INTEGER"/>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="main_subscript_order_period_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="next_invoice_day_of_period" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>

        </createTable>
        <addForeignKeyConstraint constraintName="account_type_main_subscription_period_FK"
                                 baseTableName="account_type" baseColumnNames="main_subscript_order_period_id"
                                 referencedTableName="order_period" referencedColumnNames="id"
                />
        <addForeignKeyConstraint constraintName="account_type_currency_id_FK"
                                 baseTableName="account_type" baseColumnNames="currency_id"
                                 referencedTableName="currency" referencedColumnNames="id"
                />
        <addForeignKeyConstraint constraintName="account_type_language_id_FK"
                                 baseTableName="account_type" baseColumnNames="language_id"
                                 referencedTableName="language" referencedColumnNames="id"
                />
        <addForeignKeyConstraint constraintName="invoice_delivery_method_id_FK"
                                 baseTableName="account_type" baseColumnNames="invoice_delivery_method_id"
                                 referencedTableName="invoice_delivery_method" referencedColumnNames="id"
                />

        <addForeignKeyConstraint constraintName="account_type_entity_id_FK"
                                 baseTableName="account_type" baseColumnNames="entity_id"
                                 referencedTableName="entity" referencedColumnNames="id"
                />

    </changeSet>
    
    <changeSet author="Rahul Asthana" id="add-account-type-in-jbilling_table">
        <insert tableName="jbilling_table">
        	<column name="id"  valueComputed="(select max(jt.id)+1 from jbilling_table jt)"/>
            <column name="name" value="account_type"/>
        </insert>
    </changeSet>
    
    <changeSet id="5015-remove-auto-payment" author="Gurdev Parmar" context="base">
        <dropColumn
            columnName="auto_payment"
            tableName="billing_process_configuration"/>
    </changeSet>

    <changeSet author="Vladimir Carevski" context="base" id="20130514-#4987-account-type-management">

        <!-- this is missed from the account type -->
        <insert tableName="jbilling_seqs" >
            <column name="name" value="account_type" />
            <column name="next_id" valueNumeric="1" />
        </insert>

        <addColumn tableName="customer" >
            <column name="account_type_id" type="java.sql.Types.INTEGER"/>
            <column name="invoice_design" type="java.sql.Types.VARCHAR(100)"/>
        </addColumn>

        <addForeignKeyConstraint baseTableName="customer"
                                 baseColumnNames="account_type_id"
                                 constraintName="customer_account_type_fk"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedTableName="account_type"
                                 referencedColumnNames="id"
                                 referencesUniqueColumn="false"/>

    </changeSet>

    <changeSet author="Panche Isajeski" context="base" id="20130516-#4988-account-type-pricing">

        <createTable tableName="account_type_price">
            <column name="account_type_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column  name="create_datetime" type="java.sql.Types.TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="item_account_type_availability">
            <column name="item_id" type="java.sql.Types.INTEGER"/>
            <column name="account_type_id" type="java.sql.Types.INTEGER"/>
        </createTable>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="20130516-#4988-account-type-pricing-item-std-avail" dbms="postgresql,oracle,hsqldb,h2">
        <comment>The follow 2 change sets are required until https://liquibase.jira.com/browse/CORE-1260 is fixed.
            The default value for mysql should be 0 or 1 of type tinyint</comment>
        <addColumn tableName="item" >
            <column name="standard_availability" type="java.sql.Types.BOOLEAN" defaultValue="true">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="20130516-#4988-account-type-pricing-item-std-avail" dbms="mysql">
        <addColumn tableName="item" >
            <column name="standard_availability" type="java.sql.Types.BOOLEAN" defaultValueBoolean="true">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="Oleg Baskakov" context="base" id="20130429-#4920">
        <comment>Requirement #4920 - Create MetaField Groups.</comment>

        <createTable tableName="meta_field_group">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="metafield_group_pkey"/>
            </column>
            <column name="date_created" type="java.sql.Types.DATE"/>
            <column name="date_updated" type="java.sql.Types.DATE" />
            <column name="entity_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="display_order" type="java.sql.Types.INTEGER" />
            <column name="optlock" type="java.sql.Types.INTEGER"/>
            <column name="entity_type" type="java.sql.Types.VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="meta_field_value_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addColumn tableName="meta_field_name">
            <column  name="validation_rule" type="java.sql.Types.VARCHAR(256)"/>
            <column  name="error_message" type="java.sql.Types.VARCHAR(256)"/>

        </addColumn>

        <insert tableName="jbilling_table">
            <column name="name" value="meta_field_group"/>
            <column name="id"  valueComputed="(select max(jt.id)+1 from jbilling_table jt)"/>
        </insert>

        <insert tableName="jbilling_table">
            <column name="name" value="meta_field_name"/>
            <column name="id"  valueComputed="(select max(jt.id)+1 from jbilling_table jt)"/>
        </insert>

        <!-- provide initial value for meta_field_group seqs -->
        <insert tableName="jbilling_seqs" >
            <column name="name" value="meta_field_group" />
            <column name="next_id" value="1" />
        </insert>

    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="20130429-#4920-bool-fix" dbms="postgresql,oracle,hsqldb,h2">
        <comment>The follow 2 change sets are required until https://liquibase.jira.com/browse/CORE-1260 is fixed.
            The default value for mysql should be 0 or 1 of type tinyint</comment>
        <addColumn tableName="meta_field_name">
            <column  name="is_primary" type="java.sql.Types.BOOLEAN" defaultValue="true"/>
        </addColumn>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="20130429-#4920-bool-fix" dbms="mysql">
        <addColumn tableName="meta_field_name">
            <column  name="is_primary" type="java.sql.Types.BOOLEAN" defaultValueBoolean="true"/>
        </addColumn>
    </changeSet>

    <changeSet author="Oleg Baskakov" context="base" id="20130506-#4921">
        <comment>Requirement #4921 - MetaField validation rules.</comment>
        <createTable tableName="metafield_type_map">
            <column name="metafield_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="field_usage" type="java.sql.Types.VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="Oleg Baskakov" context="base" id="20130513-#4922">
        <comment>Requirements #4922 - Create Account Information Types (AIT)</comment>

        <addColumn tableName="meta_field_group">

            <column name="discriminator" type="java.sql.Types.VARCHAR(30)" >
                <constraints nullable="false"/>
            </column>

            <column name="name" type="java.sql.Types.VARCHAR(32)" />
            <column name="account_type_id" type="java.sql.Types.INTEGER" />
        </addColumn>

        <addForeignKeyConstraint
                constraintName="account_type_main_subscription_period_FK2"
                baseTableName="meta_field_group" baseColumnNames="account_type_id"
                referencedTableName="account_type" referencedColumnNames="id"
                />
    </changeSet>

    <changeSet author="Panche Isajeski" context="base" id="#5388-Java based Metafield validation">
        <comment>Metafields - Custom Java validators</comment>
        <createTable tableName="validation_rule">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="validation_rule_pkey"/>
            </column>
            <column name="rule_type" type="java.sql.Types.VARCHAR(25)">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="java.sql.Types.BOOLEAN"/>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <dropColumn columnName="validation_rule" tableName="meta_field_name"/>

        <addColumn tableName="meta_field_name">
            <column name="validation_rule_id" type="java.sql.Types.INTEGER"/>
        </addColumn>

        <addForeignKeyConstraint baseColumnNames="validation_rule_id" baseTableName="meta_field_name"
                                 constraintName="validation_rule_fk_1" deferrable="false"
                                 initiallyDeferred="false"  onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="validation_rule" referencesUniqueColumn="false"/>

        <createTable tableName="validation_rule_attributes">
            <column name="validation_rule_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="attribute_name" type="java.sql.Types.VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="attribute_value" type="java.sql.Types.VARCHAR(255)"/>
        </createTable>

        <insert tableName="jbilling_seqs">
            <column name="name" value="validation_rule"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>

        <insert tableName="jbilling_table">
            <column name="name" value="validation_rule"/>
            <column name="id"  valueComputed="(select max(jt.id)+1 from jbilling_table jt)"/>
        </insert>

    </changeSet>

    <changeSet author="Vladimir Carevski" context="test" id="#5137-ait-for-test-account-types">


        <!-- migrate the test data to use meta fields instead of contact entity
            This makes sure that the account type Basic is awarded id 1. Used in tests thus far.-->
        <customChange class="com.sapienter.jbilling.server.migrations.MigrateCustomerAccounts" />

        <!-- Entity: Prancing Pony -->

        <!-- Private Account Type -->
        <insert tableName="account_type">
            <column name="id" valueComputed="(select max(ap.id) + 1 from account_type ap)"/>
            <column name="credit_limit" valueNumeric="0"/>
            <column name="invoice_design" value="simple_invoice_b2b"/>
            <column name="invoice_delivery_method_id" valueNumeric="1"/>
            <column name="date_created" valueDate="2010-01-01"/>
            <column name="credit_notification_limit1" valueNumeric="0"/>
            <column name="credit_notification_limit2" valueNumeric="0"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="currency_id" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="main_subscript_order_period_id" valueNumeric="2"/>
            <column name="next_invoice_day_of_period" valueNumeric="1"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select jt.id from jbilling_table jt where jt.name = 'account_type')"/>
            <column name="foreign_id" valueComputed="(select max(ap.id) from account_type ap)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Private"/>
        </insert>

        <!-- PRANCING PONY -> Private -> Primary Contact -->
        <insert tableName="meta_field_group">
            <column name="id" valueComputed="coalesce((select max(mfg.id)+1 from meta_field_group mfg), 1)"/>
            <column name="entity_id" valueNumeric="1" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="discriminator" value="ACCOUNT_TYPE" />
            <column name="name" value="Primary Contact" />
            <column name="account_type_id" valueComputed="(select max(ap.id) from account_type ap)"/>
        </insert>

        <!-- Private -> Primary Contact -> First Name -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="first.name" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="FIRST_NAME" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Private -> Primary Contact -> Last Name -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="last.name" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="2" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="LAST_NAME" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!--  Private -> Primary Contact -> Email  -->
        <sql>
            <![CDATA[
                insert into validation_rule
                    (id, rule_type, enabled, optlock)
                values
                ( coalesce((select max(vr.id)+1 from validation_rule vr), 1),
                  'SCRIPT',
                   true,
                   1
                );

                insert into meta_field_name
                    (id, name, entity_type, data_type, is_disabled, is_mandatory,
                    display_order, optlock, entity_id, is_primary, validation_rule_id)
                values
                ( coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1),
                'contact.email', 'ACCOUNT_TYPE', 'STRING', false, true, 3, 1, 1, false,
                 (select max(vr.id) from validation_rule vr)
                 );
            ]]>
        </sql>


    </changeSet>

    <changeSet author="Gerhard Maree" context="test" id="#5137-ait-for-test-account-types-2" dbms="postgresql,oracle,hsqldb,h2">
        <comment>This part of script needs to be customized per RDMS</comment>
        <sql>
            <![CDATA[
                insert into validation_rule_attributes
                (validation_rule_id, attribute_name, attribute_value)
                values
                ( (select max(vr.id) from validation_rule vr),
                'validationScript',
                E'_this.value ==~ /[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})/'
                );

            ]]>
        </sql>
    </changeSet>


    <changeSet author="Gerhard Maree" context="test" id="#5137-ait-for-test-account-types-2" dbms="mysql">
        <comment>This part of script needs to be customized per RDMS</comment>
        <sql>
            <![CDATA[
                insert into validation_rule_attributes
                (validation_rule_id, attribute_name, attribute_value)
                values
                ( (select max(vr.id) from validation_rule vr),
                'validationScript',
                '_this.value ==~ /[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})/'
                );
            ]]>
        </sql>
    </changeSet>

    <changeSet author="Vladimir Carevski" context="test" id="#5137-ait-for-test-account-types-3">

        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select jt.id from jbilling_table jt where name = 'meta_field_name')"/>
            <column name="foreign_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Email not valid"/>
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="EMAIL" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!--  Private -> Primary Contact -> Alternative Email  -->
        <sql>
            <![CDATA[

                insert into validation_rule
                    (id, rule_type, enabled, optlock)
                values
                ( coalesce((select max(vr.id)+1 from validation_rule vr), 1),
                  'SCRIPT',
                   true,
                   1
                );

                insert into meta_field_name
                    (id, name, entity_type, data_type, is_disabled, is_mandatory,
                    display_order, optlock, entity_id, is_primary, validation_rule_id)
                values
                ( coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1),
                'contact.alt.email', 'ACCOUNT_TYPE', 'STRING', false, false, 4, 1, 1, false,
                (select max(vr.id) from validation_rule vr)
                );
            ]]>
        </sql>
    </changeSet>

    <changeSet author="Gerhard Maree" context="test" id="#5137-ait-for-test-account-types-4" dbms="postgresql,oracle,hsqldb,h2">
        <comment>This part of script needs to be customized per RDMS</comment>
        <sql>
            <![CDATA[
                insert into validation_rule_attributes
                (validation_rule_id, attribute_name, attribute_value)
                values
                ( (select max(vr.id) from validation_rule vr),
                'validationScript',
                E'_this.value ==~ /[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})/'
                );

            ]]>
        </sql>
    </changeSet>

    <changeSet author="Gerhard Maree" context="test" id="#5137-ait-for-test-account-types-4" dbms="mysql">
        <comment>This part of script needs to be customized per RDMS</comment>
        <sql>
            <![CDATA[
                insert into validation_rule_attributes
                (validation_rule_id, attribute_name, attribute_value)
                values
                ( (select max(vr.id) from validation_rule vr),
                'validationScript',
                '_this.value ==~ /[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})/'
                );
            ]]>
        </sql>
    </changeSet>

    <changeSet author="Vladimir Carevski" context="test" id="#5137-ait-for-test-account-types-5">
        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select jt.id from jbilling_table jt where name = 'meta_field_name')"/>
            <column name="foreign_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Email not valid"/>
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="EMAIL" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!--  Private -> Primary Contact -> Tax Id  -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.tax.id" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="INTEGER" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="5" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- PRANCING PONY -> Private -> Shipping Address -->
        <insert tableName="meta_field_group">
            <column name="id" valueComputed="coalesce((select max(mfg.id)+1 from meta_field_group mfg), 1)"/>
            <column name="entity_id" valueNumeric="1" />
            <column name="display_order" valueNumeric="2" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="discriminator" value="ACCOUNT_TYPE" />
            <column name="name" value="Shipping Address" />
            <column name="account_type_id" valueComputed="(select max(ap.id) from account_type ap)"/>
        </insert>

        <!-- Address1 -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.address1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="ADDRESS1" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- City -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.city" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="2" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="CITY" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- State-Province -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.state.province" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="false" />
            <column name="display_order" valueNumeric="3" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="STATE_PROVINCE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Postal Code -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.postal.code" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="4" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="POSTAL_CODE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Country Code -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.country.code" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="false" />
            <column name="display_order" valueNumeric="5" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="COUNTRY_CODE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>


        <!-- PRANCING PONY -> Private -> Payment Address -->
        <insert tableName="meta_field_group">
            <column name="id" valueComputed="coalesce((select max(mfg.id)+1 from meta_field_group mfg), 1)"/>
            <column name="entity_id" valueNumeric="1" />
            <column name="display_order" valueNumeric="3" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="discriminator" value="ACCOUNT_TYPE" />
            <column name="name" value="Payment Address" />
            <column name="account_type_id" valueComputed="(select max(ap.id) from account_type ap)"/>
        </insert>

        <!-- Address1 -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.address1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="ADDRESS1" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- City -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.city" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="2" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="CITY" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- State-Province -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.state.province" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="false" />
            <column name="display_order" valueNumeric="3" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="STATE_PROVINCE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Postal Code -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.postal.code" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="4" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="POSTAL_CODE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Country Code -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.country.code" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="false" />
            <column name="display_order" valueNumeric="5" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="COUNTRY_CODE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>


        <!-- PRANCING PONY -> Business Account Type -->
        <insert tableName="account_type">
            <column name="id" valueComputed="(select max(ap.id) + 1 from account_type ap)"/>
            <column name="credit_limit" valueNumeric="0"/>
            <column name="invoice_design" value="simple_invoice_b2b"/>
            <column name="invoice_delivery_method_id" valueNumeric="1"/>
            <column name="date_created" valueDate="2010-01-01"/>
            <column name="credit_notification_limit1" valueNumeric="0"/>
            <column name="credit_notification_limit2" valueNumeric="0"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="currency_id" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="main_subscript_order_period_id" valueNumeric="2"/>
            <column name="next_invoice_day_of_period" valueNumeric="1"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select jt.id from jbilling_table jt where jt.name = 'account_type')"/>
            <column name="foreign_id" valueComputed="(select max(ap.id) from account_type ap)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Business"/>
        </insert>


        <!-- PRANCING PONY -> Business -> Company Information -->
        <insert tableName="meta_field_group">
            <column name="id" valueComputed="coalesce((select max(mfg.id)+1 from meta_field_group mfg), 1)"/>
            <column name="entity_id" valueNumeric="1" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="discriminator" value="ACCOUNT_TYPE" />
            <column name="name" value="Company Information" />
            <column name="account_type_id" valueComputed="(select max(ap.id) from account_type ap)"/>
        </insert>

        <!-- Organization Name -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.organization" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="2" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="ORGANIZATION" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Email -->
        <sql>
            <![CDATA[

                insert into validation_rule
                    (id, rule_type, enabled, optlock)
                values
                ( coalesce((select max(vr.id)+1 from validation_rule vr), 1),
                  'SCRIPT',
                   true,
                   1
                );

                insert into meta_field_name
                    (id, name, entity_type, data_type, is_disabled, is_mandatory,
                    display_order, optlock, entity_id, is_primary, validation_rule_id)
                values
                ( coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1),
                'contact.email', 'ACCOUNT_TYPE', 'STRING', false, true, 2, 1, 1, false,
                 (select max(vr.id) from validation_rule vr)
                );
            ]]>
        </sql>

    </changeSet>

    <changeSet author="Gerhard Maree" context="test" id="#5137-ait-for-test-account-types-6" dbms="postgresql,oracle,hsqldb,h2">
        <comment>This part of script needs to be customized per RDMS</comment>
        <sql>
            <![CDATA[
                insert into validation_rule_attributes
                (validation_rule_id, attribute_name, attribute_value)
                values
                ( (select max(vr.id) from validation_rule vr),
                'validationScript',
                E'_this.value ==~ /[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})/'
                );

            ]]>
        </sql>
    </changeSet>

    <changeSet author="Gerhard Maree" context="test" id="#5137-ait-for-test-account-types-6" dbms="mysql">
        <comment>This part of script needs to be customized per RDMS</comment>
        <sql>
            <![CDATA[
                insert into validation_rule_attributes
                (validation_rule_id, attribute_name, attribute_value)
                values
                ( (select max(vr.id) from validation_rule vr),
                'validationScript',
                '_this.value ==~ /[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})/'
                );
            ]]>
        </sql>
    </changeSet>

    <changeSet author="Vladimir Carevski" context="test" id="#5137-ait-for-test-account-types-7">
        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select jt.id from jbilling_table jt where name = 'meta_field_name')"/>
            <column name="foreign_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Email not valid"/>
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="EMAIL" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.tax.id" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="INTEGER" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="3" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- PRANCING PONY -> Business -> Invoicing Address -->
        <insert tableName="meta_field_group">
            <column name="id" valueComputed="coalesce((select max(mfg.id)+1 from meta_field_group mfg), 1)"/>
            <column name="entity_id" valueNumeric="1" />
            <column name="display_order" valueNumeric="2" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="discriminator" value="ACCOUNT_TYPE" />
            <column name="name" value="Invoicing Address" />
            <column name="account_type_id" valueComputed="(select max(ap.id) from account_type ap)"/>
        </insert>

        <!-- Address1 -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.address1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="ADDRESS1" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- City -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.city" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="2" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="CITY" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- State-Province -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.state.province" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="false" />
            <column name="display_order" valueNumeric="3" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="STATE_PROVINCE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Postal Code -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.postal.code" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="true" />
            <column name="display_order" valueNumeric="4" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="POSTAL_CODE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Country Code -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.country.code" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="false" />
            <column name="display_order" valueNumeric="5" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="1" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="COUNTRY_CODE" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Entity: Mordor -->

        <!-- Private Account Type -->
        <insert tableName="account_type">
            <column name="id" valueComputed="(select max(at.id)+1 from account_type at)"/>
            <column name="credit_limit" valueNumeric="0"/>
            <column name="invoice_design" value="simple_invoice_b2b"/>
            <column name="invoice_delivery_method_id" valueNumeric="1"/>
            <column name="date_created" valueDate="2010-01-01"/>
            <column name="credit_notification_limit1" valueNumeric="0"/>
            <column name="credit_notification_limit2" valueNumeric="0"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="entity_id" valueNumeric="2"/>
            <column name="currency_id" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="main_subscript_order_period_id" valueNumeric="3"/>
            <column name="next_invoice_day_of_period" valueNumeric="1"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select jt.id from jbilling_table jt where jt.name = 'account_type')"/>
            <column name="foreign_id" valueComputed="(select max(at.id) from account_type at)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Private"/>
        </insert>

        <!-- for Company MORDOR we have only one simple account type-->

        <!-- add primary contact AIT -->
        <insert tableName="meta_field_group">
            <column name="id" valueComputed="coalesce((select max(mfg.id)+1 from meta_field_group mfg), 1)"/>
            <column name="entity_id" valueNumeric="2" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="discriminator" value="ACCOUNT_TYPE" />
            <column name="name" value="Contact" />
            <column name="account_type_id" valueComputed="(select max(at.id) from account_type at)"/>
        </insert>

        <!-- First Name -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.first.name" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="false" />
            <column name="display_order" valueNumeric="1" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="2" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="FIRST_NAME" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Last Name -->
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1)"/>
            <column name="name" value="contact.last.name" />
            <column name="entity_type" value="ACCOUNT_TYPE" />
            <column name="data_type" value="STRING" />
            <column name="is_disabled" valueBoolean="false" />
            <column name="is_mandatory" valueBoolean="false" />
            <column name="display_order" valueNumeric="2" />
            <column name="optlock" valueNumeric="1" />
            <column name="entity_id" valueNumeric="2" />
            <column name="is_primary" valueBoolean="false" />
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="LAST_NAME" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- Email -->
        <sql>
            <![CDATA[

                insert into validation_rule
                    (id, rule_type, enabled, optlock)
                values
                ( coalesce((select max(vr.id)+1 from validation_rule vr), 1),
                  'SCRIPT',
                   true,
                   1
                );

                insert into meta_field_name
                    (id, name, entity_type, data_type, is_disabled, is_mandatory,
                    display_order, optlock, entity_id, is_primary, validation_rule_id)
                values
                ( coalesce((select max(mfn.id)+1 from meta_field_name mfn), 1),
                'contact.email', 'ACCOUNT_TYPE', 'STRING', false, true, 3, 1, 2, false,
                (select max(vr.id) from validation_rule vr)
                );
            ]]>
        </sql>

    </changeSet>

    <changeSet author="Gerhard Maree" context="test" id="#5137-ait-for-test-account-types-8" dbms="postgresql,oracle,hsqldb,h2">
        <comment>This part of script needs to be customized per RDMS</comment>
        <sql>
            <![CDATA[
                insert into validation_rule_attributes
                (validation_rule_id, attribute_name, attribute_value)
                values
                ( (select max(vr.id) from validation_rule vr),
                'validationScript',
                E'_this.value ==~ /[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})/'
                );

            ]]>
        </sql>
    </changeSet>

    <changeSet author="Gerhard Maree" context="test" id="#5137-ait-for-test-account-types-8" dbms="mysql">
        <comment>This part of script needs to be customized per RDMS</comment>
        <sql>
            <![CDATA[
                insert into validation_rule_attributes
                (validation_rule_id, attribute_name, attribute_value)
                values
                ( (select max(vr.id) from validation_rule vr),
                'validationScript',
                '_this.value ==~ /[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})/'
                );
            ]]>
        </sql>
    </changeSet>

    <changeSet author="Vladimir Carevski" context="test" id="#5137-ait-for-test-account-types-9">
        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select jt.id from jbilling_table jt where name = 'meta_field_name')"/>
            <column name="foreign_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Email not valid"/>
        </insert>
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="EMAIL" />
        </insert>
        <insert tableName="metafield_group_meta_field_map">
            <column name="metafield_group_id" valueComputed="(select max(mfg.id) from meta_field_group mfg)" />
            <column name="meta_field_value_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
        </insert>

        <!-- update these two sequences -->
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(p.id)+1 from account_type p)"/>
            <where>name='account_type'</where>
        </update>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(p.id)+1 from meta_field_group p)"/>
            <where>name='meta_field_group'</where>
        </update>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(p.id)+1 from meta_field_name p)"/>
            <where>name='meta_field_name'</where>
        </update>

    </changeSet>

    <changeSet author="Vladimir Carevski" context="base" id="#5137-remove-contact-type-constraints-on-contact-map" >
        <dropNotNullConstraint columnName="type_id" tableName="contact_map" columnDataType="java.sql.Types.INTEGER" />

        <dropForeignKeyConstraint baseTableName="contact_map" constraintName="contact_map_fk_1" />
        <dropIndex indexName="contact_map_i_3" tableName="contact_map"/>
        <addForeignKeyConstraint baseColumnNames="table_id" baseTableName="contact_map" constraintName="contact_map_fk_1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="jbilling_table" referencesUniqueColumn="false"/>
    </changeSet>

    <!-- post_base context executes as last context.
        Can be used to migrate test and client data
        and finish database changes -->
    <changeSet author="Vladimir Carevski" context="post_base" id="#5137-migrates-data-for-customer-account">

        <!-- migrate the data to use meta fields instead of contact entity -->
        <customChange class="com.sapienter.jbilling.server.migrations.MigrateCustomerAccounts" />

        <!-- remove the contact type table and links to it -->
        <dropForeignKeyConstraint baseTableName="contact_map" constraintName="contact_map_fk_2" />
        <dropColumn tableName="contact_map" columnName="type_id" />
        <dropTable tableName="contact_type" />

        <!-- recreate index on contact_map for columns foreign_id and table_id -->
        <createIndex tableName="contact_map" indexName="contact_map_i_2">
            <column name="table_id" />
            <column name="foreign_id" />
        </createIndex>
    </changeSet>

    <changeSet author="Shweta Gupta" context="base" id="20130531-#5237-product-dependencies">
        <createTable tableName="item_type_mandatory_map">
            <column name="item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="mandatory_type_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="item_id, mandatory_type_id" constraintName="item_type_mandatory_map_pkey" tableName="item_type_mandatory_map"/>
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="item_type_mandatory_map" constraintName="item_type_mandatory_item_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="mandatory_type_id" baseTableName="item_type_mandatory_map" constraintName="item_type_mandatory_type_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item_type" referencesUniqueColumn="false"/>

        <createTable tableName="item_type_optional_map">
            <column name="item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="optional_type_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="item_id, optional_type_id" constraintName="item_type_optional_map_pkey" tableName="item_type_optional_map"/>
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="item_type_optional_map" constraintName="item_type_optional_item_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="optional_type_id" baseTableName="item_type_optional_map" constraintName="item_type_optional_type_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item_type" referencesUniqueColumn="false"/>

        <createTable tableName="item_mandatory_map">
            <column name="item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="mandatory_item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="item_id, mandatory_item_id" constraintName="item_mandatory_map_pkey" tableName="item_mandatory_map"/>
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="item_mandatory_map" constraintName="item_mandatory_map_item_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="mandatory_item_id" baseTableName="item_mandatory_map" constraintName="item_mandatory_map_mandatory_item_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item" referencesUniqueColumn="false"/>

        <createTable tableName="item_optional_map">
            <column name="item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="optional_item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="item_id, optional_item_id" constraintName="item_optional_map_pkey" tableName="item_optional_map"/>
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="item_optional_map" constraintName="item_optional_map_item_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="optional_item_id" baseTableName="item_optional_map" constraintName="item_optional_map_optional_item_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item" referencesUniqueColumn="false"/>
    </changeSet>
    
    <changeSet author="Alexander Aksenov" context="base" id="#5293_product_inherited_order_meta_fields">
        <comment>Item related changes</comment>
        <createTable tableName="order_line_meta_fields_map">
            <column name="item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="meta_field_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="item_id"
                                 baseTableName="order_line_meta_fields_map"
                                 constraintName="ol_meta_fields_map_fk_1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="meta_field_id"
                                 baseTableName="order_line_meta_fields_map"
                                 constraintName="ol_meta_fields_map_fk_2"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_name"
                                 referencesUniqueColumn="false"/>
    </changeSet>
    
   	<changeSet author="Maruthi" context="base" id="1337623084753-114">
    	<createTable tableName="order_status">
       		<column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="order_status_pkey"/>
            </column>
            <column name="order_status_flag" type="java.sql.Types.INTEGER"/>
            <column name="entity_id" type="java.sql.Types.INTEGER"/>
        </createTable>
    </changeSet>
    
    <changeSet author="Maruthi" context="FKs" id="1337623084753-271">
        <addForeignKeyConstraint baseColumnNames="entity_id" baseTableName="order_status" constraintName="order_status_entity_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="entity" referencesUniqueColumn="false"/>
    </changeSet>
    
    <changeSet context="test" author="Maruthi" id="20120530-#5455-Customizable-Statuses-Requirements">
        <insert tableName="order_status">
            <column name="id" valueNumeric="1"/>
            <column name="order_status_flag" valueNumeric="0"/> <!-- INVOICE -->
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        <insert tableName="order_status">
            <column name="id" valueNumeric="2"/>
            <column name="order_status_flag" valueNumeric="1"/> <!-- FINISHED -->
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        <insert tableName="order_status">
            <column name="id" valueNumeric="3"/>
            <column name="order_status_flag" valueNumeric="2"/> <!-- NOT_INVOICE -->
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        <insert tableName="order_status">
            <column name="id" valueNumeric="4"/>
            <column name="order_status_flag" valueNumeric="3"/> <!-- AGEING_SUSPENDED -->
            <column name="entity_id" valueNumeric="1"/>
        </insert>
     </changeSet>
     
     <changeSet author="Maruthi" id="20120531-#5455-Customizable-Statuses-Requirements" context="test">
     	<update tableName="purchase_order">
     		<column name="status_id" value="1"></column>
     		<where>status_id=16</where>
     	</update>
     	<update tableName="purchase_order">
     		<column name="status_id" value="2"></column>
     		<where>status_id=17</where>
     	</update>
     	<update tableName="purchase_order">
     		<column name="status_id" value="3"></column>
     		<where>status_id=18</where>
     	</update>
     	<update tableName="purchase_order">
     		<column name="status_id" value="4"></column>
     		<where>status_id=19</where>
		</update>
    </changeSet>

	<changeSet id="#5338 Route-based Rating" author="Rahul Asthana">
        <createTable tableName="route">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="route_pkey"/>
            </column>
            <column name="name" type="java.sql.Types.VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="table_name" type="java.sql.Types.VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="entity_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet id="#5557 Matching Field" author="Rahul Asthana">
        <createTable tableName="matching_field">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="matching_field_pkey"/>
            </column>
            <column name="description" type="java.sql.Types.VARCHAR(255)">
                <constraints nullable="false" />
            </column>
            <column name="required" type="java.sql.Types.BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="route_id" type="java.sql.Types.INTEGER">
            </column>
            <column name="matching_field" type="java.sql.Types.VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="java.sql.Types.VARCHAR(255)">
                <constraints nullable="false"/>
            </column>

            <column name="order_sequence" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            
            <column name="longest_value" type="java.sql.Types.INTEGER">
				<constraints nullable="false"></constraints>
			</column>

			<column name="smallest_value" type="java.sql.Types.INTEGER">
				<constraints nullable="false"></constraints>
			</column>

            <column name="mandatory_fields_query" type="java.sql.Types.VARCHAR(1000)">
				<constraints nullable="false"></constraints>
			</column>

        </createTable>
        <addForeignKeyConstraint constraintName="matching_field_route_id_FK"
                                 baseTableName="matching_field" baseColumnNames="route_id"
                                 referencedTableName="route" referencedColumnNames="id"
                />
        <insert tableName="jbilling_seqs">
            <column name="name" value="matching_field" />
            <column name="next_id" valueNumeric="1" />
        </insert>
    </changeSet>

    <changeSet author="Alexander Aksenov" context="base" id="#5373 - Development: Order Hierarchies">
        <addColumn tableName="purchase_order">
            <column name="parent_order_id" type="java.sql.Types.INTEGER"/>
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="parent_order_id"
                                         baseTableName="purchase_order"
                                         constraintName="purchase_order_parent__order_id_fk"
                                         deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                         onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="purchase_order"
                                         referencesUniqueColumn="false"/>
        <addColumn tableName="order_line">
            <column name="parent_line_id" type="java.sql.Types.INTEGER"/>
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="parent_line_id"
                                                 baseTableName="order_line"
                                                 constraintName="order_line_parent_line_id_fk"
                                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_line"
                                                 referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Shweta Gupta" context="base" id="#5712 - MF1J - Java based Metafield validation">
        <addForeignKeyConstraint baseColumnNames="validation_rule_id" baseTableName="validation_rule_attributes"
                                 constraintName="validation_rule_fk_2" deferrable="false"
                                 initiallyDeferred="false"  onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="validation_rule" referencesUniqueColumn="false"/>

    </changeSet>

    <changeSet id="#5294_order_cancellation_fields" author="Bilal Nasir" context="base">
    	<comment>Adding fields in purchase_order table for order cancellation fees</comment>
    	<addColumn tableName="purchase_order">
    		<column name="cancellation_fee_type" type="java.sql.Types.VARCHAR(50)"></column>
    		<column name="cancellation_fee" type="java.sql.Types.INTEGER"></column>
    		<column name="cancellation_fee_percentage" type="java.sql.Types.INTEGER"></column>
    		<column name="cancellation_maximum_fee" type="java.sql.Types.INTEGER"></column>
    		<column name="cancellation_minimum_period" type="java.sql.Types.INTEGER"></column>
    	</addColumn>
    </changeSet>
	<changeSet id="#5294_order_cancellation_fields_table_entries" author="Bilal Nasir" context="base">
		<insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueNumeric="17"/>
            <column name="class_name" value="com.sapienter.jbilling.server.order.task.OrderCancellationTask"/>
            <column name="min_parameters" valueNumeric="1"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(t.id) from pluggable_task_type t)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="A pluggable task of type InternalEventsTask to monitor when activeUntil changes of an order"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(t.id) from pluggable_task_type t)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Order Cancellation Task"/>
        </insert>
        
        <delete tableName="pluggable_task_parameter">
			<where>task_id=450</where>
		</delete>
		<delete tableName="pluggable_task">
			<where>id=450</where>
		</delete>
		<delete tableName="international_description">
			<where>foreign_id=93 and table_id=24</where>
		</delete>
		<delete tableName="pluggable_task_type">
			<where>id=93</where>
		</delete>
		<delete tableName="pluggable_task">
			<where>type_id=41</where>
		</delete>
		<delete tableName="international_description">
			<where>foreign_id=41 and table_id=24</where>
		</delete>

		<update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(p.id)+1 from pluggable_task_type p)"/>
            <where>name='pluggable_task_type'</where>
        </update>
        
	</changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 01">
        <createTable tableName="reseller_entityid_map">
            <column name="entity_id" type="java.sql.Types.INTEGER">
		<constraints nullable="false"/>
	    </column>
            <column name="user_id" type="java.sql.Types.INTEGER">
		<constraints nullable="false"/>
	    </column>
        </createTable>
    </changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 02">
        <addForeignKeyConstraint baseColumnNames="entity_id" baseTableName="reseller_entityid_map" constraintName="reseller_entityid_map_fk_1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="entity" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="reseller_entityid_map" constraintName="reseller_entityid_map_fk_2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="base_user" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 03">
        <addColumn tableName="entity">
            <column defaultValueBoolean="false" name="invoice_as_reseller" type="java.sql.Types.BOOLEAN">
		<constraints nullable="false"/>
	    </column>
	    <column name="parent_id" type="java.sql.Types.INTEGER"/>
        </addColumn>
    </changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 04">
        <addForeignKeyConstraint baseColumnNames="parent_id" baseTableName="entity" constraintName="entity_fk_3" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="entity" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 05">
        <createTable tableName="item_entity_map">
            <column name="item_id" type="java.sql.Types.INTEGER">
	    	<constraints nullable="false"/>
	    </column>
            <column name="entity_id" type="java.sql.Types.INTEGER">
 		<constraints nullable="false"/>
 	    </column>
        </createTable>
    </changeSet>	
    
    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 06">
        <createTable tableName="item_type_entity_map">
            <column name="item_type_id" type="java.sql.Types.INTEGER">
		<constraints nullable="false"/>
            </column>
	    <column name="entity_id" type="java.sql.Types.INTEGER">
		<constraints nullable="false"/>
	    </column>
        </createTable>
    </changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 07">
        <addForeignKeyConstraint baseColumnNames="entity_id" baseTableName="item_entity_map" constraintName="item_entity_map_fk1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="entity" referencesUniqueColumn="false"/>
    </changeSet>
    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 08">
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="item_entity_map" constraintName="item_entity_map_fk2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 09">
        <addForeignKeyConstraint baseColumnNames="entity_id" baseTableName="item_type_entity_map" constraintName="item_type_entity_map_fk1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="entity" referencesUniqueColumn="false"/>
    </changeSet>
    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 10">
        <addForeignKeyConstraint baseColumnNames="item_type_id" baseTableName="item_type_entity_map" constraintName="item_type_entity_map_fk2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item_type" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 11">
        <addColumn tableName="item">
            <column defaultValueBoolean="false" name="global" type="java.sql.Types.BOOLEAN">
		<constraints nullable="false"/>
	    </column>
        </addColumn>
	<addColumn tableName="item_type">
            <column defaultValueBoolean="false" name="global" type="java.sql.Types.BOOLEAN">
		<constraints nullable="false"/>
	    </column>
    </addColumn>
	<addColumn tableName="purchase_order">
            <column name="reseller_order" type="java.sql.Types.INTEGER"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - 15">
    	<insert tableName="pluggable_task_type">
    		<column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
       		<column name="category_id" valueNumeric="17"/>
       		<column name="class_name" value="com.sapienter.jbilling.server.order.task.CreateOrderForResellerTask"/>
       		<column name="min_parameters" valueNumeric="0"/>
    	</insert>
        <insert tableName="pluggable_task_type">
    		<column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
       		<column name="category_id" valueNumeric="17"/>
       		<column name="class_name" value="com.sapienter.jbilling.server.invoice.task.DeleteResellerOrderTask"/>
       		<column name="min_parameters" valueNumeric="0"/>
    	</insert>
    </changeSet>
    
    <changeSet id="requirement 5546 - 20130716" author="Vikas Bodani">
        <insert tableName="event_log_message">
            <column name="id" valueComputed="(select max(e.id)+1 from event_log_message e)"></column>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="47"/>
            <column name="foreign_id" valueNumeric="35"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="A Reseller Order was created for the Root Entity during Invoice generation for a Child Entity."/>
        </insert>
    </changeSet>

	<changeSet author="Khobab Chaudhary" context="test" id="requirement #5292 - child_reseller">
        <insert tableName="entity">
            <column name="id" valueComputed="(select max(e.id)+1 from entity e)"/>
            <column name="external_id"/>
            <column name="description" value="Reseller Organization"/>
            <column name="create_datetime" valueDate="2013-07-12T00:00:00.0"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="currency_id" valueNumeric="1"/>
            <column name="optlock" valueNumeric="1"/>
		    <column name="invoice_as_reseller" valueBoolean="true"/>
		    <column name="parent_id" valueNumeric="1"/>
        </insert>

  
    	<insert tableName="base_user">
            <column name="id" valueComputed="(select max(t.id)+1 from base_user t)"/>
            <column name="entity_id" valueComputed="(select max(e.id) from entity e)"/>
            <column name="password" value="46f94c8de14fb36680850768ff1b7f2a"/> <!-- password: 123qwe -->
            <column name="deleted" valueNumeric="0"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="status_id" valueNumeric="1"/>
            <column name="subscriber_status" valueNumeric="9"/>
            <column name="currency_id" valueNumeric="1"/>
            <column name="create_datetime" valueDate="2013-07-12T00:00:00.0"/>
            <column name="last_status_change"/>
            <column name="last_login"/>
            <column name="user_name" value="admin"/>
            <column name="failed_attempts" valueNumeric="0"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
 
    	<insert tableName="base_user">
            <column name="id" valueComputed="(select max(t.id)+1 from base_user t)"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="password" value="5f4dcc3b5aa765d61d8327deb882cf99"/> <!-- password = password -->
            <column name="deleted" valueNumeric="0"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="status_id" valueNumeric="1"/>
            <column name="subscriber_status" valueNumeric="14"/>
            <column name="currency_id" valueNumeric="1"/>
            <column name="create_datetime" valueDate="2013-07-12T00:00:00.0"/>
            <column name="last_status_change"/>
            <column name="last_login"/>
            <column name="user_name" value="Reseller Organization"/>
            <column name="failed_attempts" valueNumeric="0"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="customer">
            <column name="id" valueComputed="(select max(t.id)+1 from customer t)"/>
            <column name="user_id" valueComputed="(select max(t.id) from base_user t)"/>
            <column name="partner_id"/>
            <column name="referral_fee_paid"/>
            <column name="invoice_delivery_method_id" valueNumeric="1"/>
            <column name="notes" value=""/>
            <column name="auto_payment_type"/>
            <column name="due_date_unit_id"/>
            <column name="due_date_value"/>
            <column name="df_fm"/>
            <column name="parent_id"/>
            <column name="is_parent"/>
            <column name="exclude_aging" valueNumeric="0"/>
            <column name="invoice_child"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="balance_type" valueNumeric="1"/>
            <column name="dynamic_balance" valueNumeric="0E-10"/>
            <column name="credit_limit" valueNumeric="0E-10"/>
            <column name="auto_recharge" valueNumeric="0E-10"/>
            <column name="use_parent_pricing" valueBoolean="false"/>
	    <column name="main_subscript_order_period_id" valueNumeric="2"/>
	    <column name="next_invoice_day_of_period" valueNumeric="1"/>
	    <column name="account_type_id" valueNumeric="1"/>
	    <column name="invoice_design" value=""/>
        </insert>

    	<insert tableName="reseller_entityid_map">
            <column name="user_id" valueComputed="(select max(t.id) from base_user t)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
    	</insert>

    	<insert tableName="entity_payment_method_map">
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="payment_method_id" valueNumeric="1"/>        
    	</insert>

    	<insert tableName="entity_payment_method_map">
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="payment_method_id" valueNumeric="2"/>        
    	</insert>

    	<insert tableName="entity_payment_method_map">
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="payment_method_id" valueNumeric="3"/>        
    	</insert>

    	<insert tableName="order_period">
            <column name="id" valueComputed="(select max(t.id)+1 from order_period t)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>   
            <column name="value" valueNumeric="1"/>
            <column name="unit_id" valueNumeric="1"/> 
            <column name="optlock" valueNumeric="0"/>      
    	</insert>
	<insert tableName="international_description">
            <column name="table_id" valueNumeric="17"/>
            <column name="foreign_id" valueComputed="(select max(t.id) from order_period t)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Monthly"/>
        </insert>

	<insert tableName="billing_process_configuration">
            <column name="id" valueComputed="(select max(t.id)+1 from billing_process_configuration t)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="next_run_date" valueDate="2013-08-12"/>
            <column name="generate_report" valueNumeric="1"/>
            <column name="retries" valueNumeric="0"/>
            <column name="days_for_retry" valueNumeric="1"/>
            <column name="days_for_report" valueNumeric="3"/>
            <column name="review_status" valueNumeric="1"/>
            <column name="due_date_unit_id" valueNumeric="1"/>
            <column name="due_date_value" valueNumeric="1"/>
            <column name="df_fm"/>
            <column name="only_recurring" valueNumeric="1"/>
            <column name="invoice_date_process" valueNumeric="0"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="maximum_periods" valueNumeric="1"/>
            <column name="auto_payment_application" valueNumeric="1"/>
        </insert>

    	<insert tableName="entity_delivery_method_map">
            <column name="method_id" valueNumeric="1"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_delivery_method_map">
            <column name="method_id" valueNumeric="2"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_delivery_method_map">
            <column name="method_id" valueNumeric="3"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="11"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="3"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="8"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="9"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="12"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="7"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="2"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="1"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="5"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="6"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="entity_report_map">
            <column name="report_id" valueNumeric="4"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>        
	</insert>

	<insert tableName="contact">
            <column name="id" valueComputed="(select max(t.id)+1 from contact t)"/>
            <column name="organization_name" value="Reseller Organization"/>
            <column name="street_addres1" value="156 McDowell Street"/>
            <column name="street_addres2" value=""/>
            <column name="city" value="Palmyra"/>
            <column name="state_province" value="New York"/>
            <column name="postal_code" value="37142"/>
            <column name="country_code" value="US"/>
            <column name="last_name" value="Haas"/>
            <column name="first_name" value="Spencer"/>
            <column name="person_initial"/>
            <column name="person_title"/>
            <column name="phone_country_code" valueNumeric="1"/>
            <column name="phone_area_code" valueNumeric="812"/>
            <column name="phone_phone_number" value="8370038"/>
            <column name="fax_country_code"/>
            <column name="fax_area_code"/>
            <column name="fax_phone_number"/>
            <column name="email" value="spencerTHaas@email.com"/>
            <column name="create_datetime" valueDate="2013-07-12T00:00:00.0"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="notification_include"/>
            <column name="user_id" valueComputed="(select max(t.id)-1 from base_user t)"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="contact">
            <column name="id" valueComputed="(select max(t.id)+1 from contact t)"/>
            <column name="organization_name" value="Reseller Organization"/>
            <column name="street_addres1" value="156 McDowell Street"/>
            <column name="street_addres2" value=""/>
            <column name="city" value="Palmyra"/>
            <column name="state_province" value="New York"/>
            <column name="postal_code" value="37142"/>
            <column name="country_code" value="US"/>
            <column name="last_name" value="Haas"/>
            <column name="first_name" value="Spencer"/>
            <column name="person_initial"/>
            <column name="person_title"/>
            <column name="phone_country_code" valueNumeric="1"/>
            <column name="phone_area_code" valueNumeric="812"/>
            <column name="phone_phone_number" value="8370038"/>
            <column name="fax_country_code"/>
            <column name="fax_area_code"/>
            <column name="fax_phone_number"/>
            <column name="email" value="spencerTHaas@email.com"/>
            <column name="create_datetime" valueDate="2013-07-12T00:00:00.0"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="notification_include"/>
            <column name="user_id" valueComputed="(select max(t.id) from base_user t)"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="contact">
            <column name="id" valueComputed="(select max(t.id)+1 from contact t)"/>
            <column name="organization_name" value="Reseller Organization"/>
            <column name="street_addres1" value="156 McDowell Street"/>
            <column name="street_addres2" value=""/>
            <column name="city" value="Palmyra"/>
            <column name="state_province" value="New York"/>
            <column name="postal_code" value="37142"/>
            <column name="country_code" value="US"/>
            <column name="last_name" value="Haas"/>
            <column name="first_name" value="Spencer"/>
            <column name="person_initial"/>
            <column name="person_title"/>
            <column name="phone_country_code" valueNumeric="1"/>
            <column name="phone_area_code" valueNumeric="812"/>
            <column name="phone_phone_number" value="8370038"/>
            <column name="fax_country_code"/>
            <column name="fax_area_code"/>
            <column name="fax_phone_number"/>
            <column name="email" value="spencerTHaas@email.com"/>
            <column name="create_datetime" valueDate="2013-07-12T00:00:00.0"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="notification_include"/>
            <column name="user_id"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="contact_map">
            <column name="id" valueComputed="(select max(t.id)+1 from contact_map t)"/>
            <column name="contact_id" valueComputed="(select max(t.id)-2 from contact t)"/>
            <column name="table_id" valueNumeric="5"/>
            <column name="foreign_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
	<insert tableName="contact_map">
            <column name="id" valueComputed="(select max(t.id)+1 from contact_map t)"/>
            <column name="contact_id" valueComputed="(select max(t.id)-1 from contact t)"/>
            <column name="table_id" valueNumeric="10"/>
            <column name="foreign_id" valueComputed="(select max(t.id)-1 from base_user t)"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="contact_map">
            <column name="id" valueComputed="(select max(t.id)+1 from contact_map t)"/>
            <column name="contact_id" valueComputed="(select max(t.id) from contact t)"/>
            <column name="table_id" valueNumeric="10"/>
            <column name="foreign_id" valueComputed="(select max(t.id) from base_user t)"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="role">
            <column name="id" valueComputed="(select max(t.id)+1 from role t)"/>
	    <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="role_type_id" valueNumeric="2"/>
        </insert>
	<insert tableName="role">
            <column name="id" valueComputed="(select max(t.id)+1 from role t)"/>
	    <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="role_type_id" valueNumeric="3"/>
        </insert>
	<insert tableName="role">
            <column name="id" valueComputed="(select max(t.id)+1 from role t)"/>
	    <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="role_type_id" valueNumeric="5"/>
        </insert>
	<insert tableName="role">
            <column name="id" valueComputed="(select max(t.id)+1 from role t)"/>
	    <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="role_type_id" valueNumeric="4"/>
        </insert>

	<insert tableName="user_role_map">
            <column name="user_id" valueComputed="(select max(t.id)-1 from base_user t)"/>
            <column name="role_id" valueComputed="(select max(t.id)-3 from role t)"/>
        </insert>
	<insert tableName="user_role_map">
            <column name="user_id" valueComputed="(select max(t.id) from base_user t)"/>
            <column name="role_id" valueNumeric="5"/>
        </insert>
        
	<insert tableName="international_description">
            <column name="table_id" valueNumeric="60"/>
            <column name="foreign_id" valueComputed="(select max(t.id)-3 from role t)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="The super user of an entity"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="60"/>
            <column name="foreign_id" valueComputed="(select max(t.id)-3 from role t)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Super user"/>
        </insert>
	<insert tableName="international_description">
            <column name="table_id" valueNumeric="60"/>
            <column name="foreign_id" valueComputed="(select max(id)-2 from role)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="A billing clerk"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="60"/>
            <column name="foreign_id" valueComputed="(select max(id)-2 from role)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Clerk"/>
        </insert>
	<insert tableName="international_description">
            <column name="table_id" valueNumeric="60"/>
            <column name="foreign_id" valueComputed="(select max(id)-1 from role)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="A customer that will query his/her account"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="60"/>
            <column name="foreign_id" valueComputed="(select max(id)-1 from role)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Customer"/>
        </insert>
	<insert tableName="international_description">
            <column name="table_id" valueNumeric="60"/>
            <column name="foreign_id" valueComputed="(select max(id) from role)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="A partner that will bring customers"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="60"/>
            <column name="foreign_id" valueComputed="(select max(id) from role)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Partner"/>
        </insert>
        
	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="21"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>
        
	<insert tableName="pluggable_task_parameter">
            <column name="id" valueComputed="(select max(pp.id)+1 from pluggable_task_parameter pp)"/>
            <column name="task_id" valueComputed="(select max(p.id) from pluggable_task p)"/>
            <column name="name" value="all"/>
            <column name="int_value"/>
            <column name="str_value" value="yes"/>
            <column name="float_value"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        
	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="9"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>
        
	<insert tableName="pluggable_task_parameter">
            <column name="id" valueComputed="(select max(pp.id)+1 from pluggable_task_parameter pp)"/>
            <column name="task_id" valueComputed="(select max(p.id) from pluggable_task p)"/>
            <column name="name" value="smtp_server"/>
            <column name="int_value"/>
            <column name="str_value" value="localhost"/>
            <column name="float_value"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="pluggable_task_parameter">
            <column name="id" valueComputed="(select max(pp.id)+1 from pluggable_task_parameter pp)"/>
            <column name="task_id" valueComputed="(select max(p.id) from pluggable_task p)"/>
            <column name="name" value="port"/>
            <column name="int_value"/>
            <column name="str_value" value="25"/>
            <column name="float_value"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="pluggable_task_parameter">
            <column name="id" valueComputed="(select max(pp.id)+1 from pluggable_task_parameter pp)"/>
            <column name="task_id" valueComputed="(select max(p.id) from pluggable_task p)"/>
            <column name="name" value="ssl_auth"/>
            <column name="int_value"/>
            <column name="str_value" value="false"/>
            <column name="float_value"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="pluggable_task_parameter">
            <column name="id" valueComputed="(select max(pp.id)+1 from pluggable_task_parameter pp)"/>
            <column name="task_id" valueComputed="(select max(p.id) from pluggable_task p)"/>
            <column name="name" value="tls"/>
            <column name="int_value"/>
            <column name="str_value" value="false"/>
            <column name="float_value"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="pluggable_task_parameter">
            <column name="id" valueComputed="(select max(pp.id)+1 from pluggable_task_parameter pp)"/>
            <column name="task_id" valueComputed="(select max(p.id) from pluggable_task p)"/>
            <column name="name" value="username"/>
            <column name="int_value"/>
            <column name="str_value" value="username"/>
            <column name="float_value"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="pluggable_task_parameter">
            <column name="id" valueComputed="(select max(pp.id)+1 from pluggable_task_parameter pp)"/>
            <column name="task_id" valueComputed="(select max(p.id) from pluggable_task p)"/>
            <column name="name" value="password"/>
            <column name="int_value"/>
            <column name="str_value" value="password"/>
            <column name="float_value"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="12"/>
            <column name="processing_order" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

        <insert tableName="pluggable_task_parameter">
            <column name="id" valueComputed="(select max(pp.id)+1 from pluggable_task_parameter pp)"/>
            <column name="task_id" valueComputed="(select max(p.id) from pluggable_task p)"/>
            <column name="name" value="design"/>
            <column name="int_value"/>
            <column name="str_value" value="simple_invoice_b2b"/>
            <column name="float_value"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="1"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="3"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="4"/>
            <column name="processing_order" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="5"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="6"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="7"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="10"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="25"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="79"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="28"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
	</insert>

    <insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="33"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
    </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="54"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="82"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="88"/>
            <column name="processing_order" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="87"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueNumeric="69"/>
            <column name="processing_order" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueComputed="(select ptp.id from pluggable_task_type ptp where class_name='com.sapienter.jbilling.server.order.task.CreateOrderForResellerTask')"/>
            <column name="processing_order" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>

	<insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(pt.id)+1 from pluggable_task pt)"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="type_id" valueComputed="(select ptp.id from pluggable_task_type ptp where class_name='com.sapienter.jbilling.server.invoice.task.DeleteResellerOrderTask')"/>
            <column name="processing_order" valueNumeric="3"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="notes"/>
        </insert>
	

	<insert tableName="preference">
            <column name="id" valueComputed="(select max(p.id)+1 from preference p)"/>
            <column name="type_id" valueNumeric="14"/>
            <column name="table_id" valueNumeric="5"/>
            <column name="foreign_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="value" value="1"/>
        </insert>

	<insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueNumeric="1"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
	    <column name="attachment_type" value=""/>
       	    <column name="include_attachment"/>
	    <column name="attachment_design" value=""/>
	    <column name="notify_admin" valueNumeric="0"/>
	    <column name="notify_partner" valueNumeric="0"/>
	    <column name="notify_parent" valueNumeric="0"/>
	    <column name="notify_all_parents" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueNumeric="2"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
	    <column name="attachment_type" value=""/>
	    <column name="include_attachment"/>
	    <column name="attachment_design" value=""/>
	    <column name="notify_admin" valueNumeric="0"/>
	    <column name="notify_partner" valueNumeric="0"/>
	    <column name="notify_parent" valueNumeric="0"/>
	    <column name="notify_all_parents" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueNumeric="3"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
	    <column name="attachment_type" value=""/>
	    <column name="include_attachment"/>
	    <column name="attachment_design" value=""/>
	    <column name="notify_admin" valueNumeric="0"/>
	    <column name="notify_partner" valueNumeric="0"/>
	    <column name="notify_parent" valueNumeric="0"/>
	    <column name="notify_all_parents" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueNumeric="13"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
	    <column name="attachment_type" value=""/>
	    <column name="include_attachment"/>
	    <column name="attachment_design" value=""/>
	    <column name="notify_admin" valueNumeric="0"/>
	    <column name="notify_partner" valueNumeric="0"/>
	    <column name="notify_parent" valueNumeric="0"/>
	    <column name="notify_all_parents" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueNumeric="16"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
	    <column name="attachment_type" value=""/>
	    <column name="include_attachment"/>
	    <column name="attachment_design" value=""/>
	    <column name="notify_admin" valueNumeric="0"/>
	    <column name="notify_partner" valueNumeric="0"/>
	    <column name="notify_parent" valueNumeric="0"/>
	    <column name="notify_all_parents" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueNumeric="17"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
	    <column name="attachment_type" value=""/>
	    <column name="include_attachment"/>
	    <column name="attachment_design" value=""/>
	    <column name="notify_admin" valueNumeric="0"/>
	    <column name="notify_partner" valueNumeric="0"/>
	    <column name="notify_parent" valueNumeric="0"/>
	    <column name="notify_all_parents" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueNumeric="18"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
	    <column name="attachment_type" value=""/>
	    <column name="include_attachment"/>
	    <column name="attachment_design" value=""/>
	    <column name="notify_admin" valueNumeric="0"/>
	    <column name="notify_partner" valueNumeric="0"/>
	    <column name="notify_parent" valueNumeric="0"/>
	    <column name="notify_all_parents" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueNumeric="19"/>
            <column name="entity_id" valueComputed="(select max(t.id) from entity t)"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
	    <column name="attachment_type" value=""/>
	    <column name="include_attachment"/>
	    <column name="attachment_design" value=""/>
	    <column name="notify_admin" valueNumeric="0"/>
	    <column name="notify_partner" valueNumeric="0"/>
	    <column name="notify_parent" valueNumeric="0"/>
	    <column name="notify_all_parents" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-7 from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-7 from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-6 from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-6 from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-5 from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-5 from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-4 from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-4 from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-3 from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-3 from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-2 from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-2 from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-1 from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id)-1 from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
	<insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id) from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_section m)"/>
            <column name="message_id" valueComputed="(select max(id) from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id" valueComputed="(select max(id)-15 from notification_message_section)"/>
            <column name="content" value="Billing Statement from $company_name"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id"/>
            <column name="content" value="Dear $first_name $last_name,&#10;&#10; This is to notify you that your latest invoice (number $number) is now available. The total amount due is: $total. You can view it by login in to:&#10;&#10;&quot; + Util.getSysProp(&quot;url&quot;) + &quot;/billing/user/login.jsp?entityId=$company_id&#10;&#10;For security reasons, your statement is password protected.&#10;To login in, you will need your user name: $username and your account password: $password&#10; &#10; After logging in, please click on the menu option  List, to see all your invoices.  You can also see your payment history, your current purchase orders, as well as update your payment information and submit online payments.&#10;&#10;&#10;Thank you for choosing $company_name, we appreciate your business,&#10;&#10;Billing Department&#10;$company_name"
/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id"/>
            <column name="content" value="Dear $first_name $last_name,&#10;&#10;  This email is to notify you that we have received your latest payment and your account no longer has an overdue balance.&#10;&#10;  Thank you for keeping your account up to date,&#10;&#10;&#10;Billing Department&#10;$company_name"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id" valueComputed="(select max(id)-12 from notification_message_section)"/>
            <column name="content" value="You account is now up to date"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id"/>
            <column name="content" value="Dear $first_name $last_name,&#10;&#10;Our records show that you have an overdue balance on your account. Please submit a payment as soon as possible.&#10;&#10;Best regards,&#10;&#10;Billing Department&#10;$company_name"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id" valueComputed="(select max(id)-10 from notification_message_section)"/>
            <column name="content" value="Overdue Balance"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id" valueComputed="(select max(id)-9 from notification_message_section)"/>
            <column name="content" value="Your service from $company_name is about to expire"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id"/>
            <column name="content" value="Dear $first_name $last_name,&#10;&#10;Your service with us will expire on $period_end. Please make sure to contact customer service for a renewal.&#10;&#10;Regards,&#10;&#10;Billing Department&#10;$company_name"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id"/>
            <column name="content" value="Dear $first_name $last_name&#10;&#10;   We have received your payment made with $method for a total of $total.&#10;&#10;   Thank you, we appreciate your business,&#10;&#10;Billing Department&#10;$company_name"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id" valueComputed="(select max(id)-6 from notification_message_section)"/>
            <column name="content" value="Thank you for your payment"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id" valueComputed="(select max(id)-5 from notification_message_section)"/>
            <column name="content" value="Payment failed"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id"/>
            <column name="content" value="Dear $first_name $last_name&#10;&#10;   We have received your payment made with $method for a total of $total.&#10;&#10;   Thank you, we appreciate your business,&#10;&#10;Billing Department&#10;$company_name"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id"/>
            <column name="content" value="Dear $first_name $last_name&#10;&#10;   We have received your payment made with $method for a total of $total.&#10;&#10;   Thank you, we appreciate your business,&#10;&#10;Billing Department&#10;$company_name"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id" valueComputed="(select max(id)-2 from notification_message_section)"/>
            <column name="content" value="Invoice remainder"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id"/>
            <column name="content" value="Dear $first_name $last_name,&#10;&#10;We want to remind you that the credit card that we have in our records for your account is about to expire. Its expiration date is $expiry_date.&#10;&#10;Updating your credit card is easy. Just login into &quot; + Util.getSysProp(&quot;url&quot;) + &quot;/billing/user/login.jsp?entityId=$company_id. using your user name: $username and password: $password. After logging in, click on 'Account' and then 'Edit Credit Card'. &#10;Thank you for keeping your account up to date.&#10;&#10;Billing Department&#10;$company_name"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

	<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(m.id)+1 from notification_message_line m)"/>
            <column name="message_section_id" valueComputed="(select max(id) from notification_message_section)"/>
            <column name="content" value="It is time to update your credit card"/>
            <column name="optlock" valueNumeric="0"/>
    </insert>
	
	<update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(r.id)+ 1 from role r)"/>
	    <where> name = 'role' </where>
        </update>
    </changeSet> 

    <changeSet author="Khobab Chaudhary" context="base" id="requirement # 5292 - remove-asset-entity-not-null-constraint">
        <dropNotNullConstraint columnName="entity_id" columnDataType="java.sql.Types.INTEGER" tableName="asset"/>
    </changeSet>
    
    <changeSet author="Vladimir Carevski" context="base" id="#5487-script-meta-field" >
        <addColumn tableName="meta_field_name">
            <column name="filename" type="java.sql.Types.VARCHAR(100)"></column>
        </addColumn>
    </changeSet>

    <changeSet author="Khobab Chaudhary" context="base" id="#6168 - item_type_nullable_entity">
   		<dropNotNullConstraint columnName="entity_id" columnDataType="java.sql.Types.INTEGER" tableName="item_type"/>
    </changeSet>
    
    <changeSet context="post_base" id="#company-hierarchy-feature-migrate-existing-items-plan-items" author="Vikas Bodani">
		<customChange class="com.sapienter.jbilling.server.migrations.MigrateSharedEntities"/>    	
    </changeSet>
    
    <changeSet id="#6168 - unique constraint on item_entity_map" author="Vikas Bodani">
    	<addUniqueConstraint tableName="item_entity_map" columnNames="entity_id, item_id" constraintName="item_entity_map_uc_1"/>
    </changeSet>
    
    <changeSet author="Khobab Chaudhary" context="base" id="#5711 - ait-timeline">
		<createTable tableName="customer_account_info_type_timeline">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
	    	<column name="customer_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="account_info_type_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
	    	<column name="meta_field_value_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="effective_date" type="java.sql.Types.DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>

		<addPrimaryKey columnNames="id" constraintName="customer_account_info_type_timeline_pkey" tableName="customer_account_info_type_timeline"/>
	
		<addUniqueConstraint tableName="customer_account_info_type_timeline"
                             columnNames="customer_id,meta_field_value_id,account_info_type_id"
                             constraintName="customer_account_info_type_timeline_uk"/>

        <addForeignKeyConstraint baseColumnNames="customer_id"
                                         baseTableName="customer_account_info_type_timeline"
                                         constraintName="customer_account_info_type_timeline_customer_id_fk"
                                         deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                         onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="customer"
                                         referencesUniqueColumn="false"/>

		<addForeignKeyConstraint baseColumnNames="account_info_type_id"
                                         baseTableName="customer_account_info_type_timeline"
                                         constraintName="customer_account_info_type_timeline_account_info_type_id_fk"
                                         deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                         onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_group"
                                         referencesUniqueColumn="false"/>

		<addForeignKeyConstraint baseColumnNames="meta_field_value_id"
                                         baseTableName="customer_account_info_type_timeline"
                                         constraintName="customer_account_info_type_timeline_meta_field_value_id_fk"
                                         deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                         onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_value"
                                         referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="20130912-#5815 Minimum Quantities for Dependencies">
        <comment>Specify minimum and maximum quantities for product dependencies</comment>

        <createTable tableName="item_dependency">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="item_dependency_pk"/>
            </column>
            <column name="dtype" type="java.sql.Types.VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column name="item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="min" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="max" type="java.sql.Types.INTEGER" />
            <column name="dependent_item_id" type="java.sql.Types.INTEGER" />
            <column name="dependent_item_type_id" type="java.sql.Types.INTEGER" />
        </createTable>

        <addForeignKeyConstraint baseColumnNames="item_id"
                                 baseTableName="item_dependency"
                                 constraintName="item_dependency_fk1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="dependent_item_id"
                                 baseTableName="item_dependency"
                                 constraintName="item_dependency_fk2"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="dependent_item_type_id"
                                 baseTableName="item_dependency"
                                 constraintName="item_dependency_fk3"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item_type"
                                 referencesUniqueColumn="false"/>

        <insert tableName="jbilling_table">
            <column name="name" value="item_dependency"/>
            <column name="id"  valueComputed="coalesce((select max(t.id)+1 from item_dependency t),1)"/>
        </insert>

        <insert tableName="jbilling_seqs">
            <column name="name" value="item_dependency"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="20130912-#5815 Migration" dbms="postgresql,oracle">
        <sql>
            <![CDATA[
                    insert into item_dependency(id, dtype, item_id, min, max, dependent_item_id, dependent_item_type_id)
                    select coalesce( (select max(id)+1 from item_dependency),1) + (row_number() over(order by item_id) )
                        ,'item', item_id ,1, null, mandatory_item_id, null from item_mandatory_map ;

                    insert into item_dependency(id, dtype, item_id, min, max, dependent_item_id, dependent_item_type_id)
                    select coalesce( (select max(id)+1 from item_dependency),1)+ (row_number() over(order by item_id) )
                        ,'item', item_id ,0, null, optional_item_id, null from item_optional_map ;

                    insert into item_dependency(id, dtype, item_id, min, max, dependent_item_id, dependent_item_type_id)
                    select coalesce( (select max(id)+1 from item_dependency),1) + (row_number() over(order by item_id) )
                        ,'item_type', item_id ,1, null, mandatory_type_id, null from item_type_mandatory_map ;

                    insert into item_dependency(id, dtype, item_id, min, max, dependent_item_id, dependent_item_type_id)
                    select coalesce( (select max(id)+1 from item_dependency),1) + (row_number() over(order by item_id) )
                        ,'item_type', item_id ,0, null, optional_type_id, null from item_type_optional_map ;
            ]]>
        </sql>


        <dropTable tableName="item_type_mandatory_map" />
        <dropTable tableName="item_type_optional_map" />
        <dropTable tableName="item_mandatory_map" />
        <dropTable tableName="item_optional_map" />

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select coalesce( (select max(id)+1 from item_dependency),1))"/>
            <where>name='item_dependency'</where>
        </update>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="20130912-#5815 Migration" dbms="mysql">
        <sql>
            <![CDATA[
                    insert into item_dependency(id, dtype, item_id, min, max, dependent_item_id, dependent_item_type_id)
                    select coalesce( (select max(id)+1 from item_dependency),1) + (@curRank := @curRank + 1)
                        ,'item', item_id ,1, null, mandatory_item_id, null from item_mandatory_map, (SELECT @curRank := 0) r ;

                    insert into item_dependency(id, dtype, item_id, min, max, dependent_item_id, dependent_item_type_id)
                    select coalesce( (select max(id)+1 from item_dependency),1) + (@curRank := @curRank + 1)
                        ,'item', item_id ,0, null, optional_item_id, null from item_optional_map, (SELECT @curRank := 0) r ;

                    insert into item_dependency(id, dtype, item_id, min, max, dependent_item_id, dependent_item_type_id)
                    select coalesce( (select max(id)+1 from item_dependency),1) + (@curRank := @curRank + 1)
                        ,'item_type', item_id ,1, null, mandatory_type_id, null from item_type_mandatory_map, (SELECT @curRank := 0) r ;

                    insert into item_dependency(id, dtype, item_id, min, max, dependent_item_id, dependent_item_type_id)
                    select coalesce( (select max(id)+1 from item_dependency),1) + (@curRank := @curRank + 1)
                        ,'item_type', item_id ,0, null, optional_type_id, null from item_type_optional_map, (SELECT @curRank := 0) r ;
            ]]>
        </sql>


        <dropTable tableName="item_type_mandatory_map" />
        <dropTable tableName="item_type_optional_map" />
        <dropTable tableName="item_mandatory_map" />
        <dropTable tableName="item_optional_map" />

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select coalesce( (select max(id)+1 from item_dependency),1))"/>
            <where>name='item_dependency'</where>
        </update>
    </changeSet>

    <changeSet author="Maeis Gharibjanian" context="base" id="20130830-#5611">
        <comment>Adds columns to customer for credit notification limit1 and limit2</comment>

        <addColumn tableName="customer">
            <column name="credit_notification_limit1" type="java.sql.Types.NUMERIC(22,10)">
                <constraints nullable="true"/>
            </column>
            <column name="credit_notification_limit2" type="java.sql.Types.NUMERIC(22,10)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="Maeis Gharibjanian" context="test" id="20130902-#5611">

        <!-- Content for the Credit Limitation 1 notification -->

        <insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueComputed="  (select max(foreign_id) from international_description id
                                                    where id.table_id = 52
                                                        and id.psudo_column = 'description'
                                                        and id.language_id = 1
                                                        and id.content = 'Credit Limitation 1')"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(nms.id)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(id) from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(nml.id)+1 from notification_message_line nml)"/>
            <column name="message_section_id" valueComputed="(select max(id) from notification_message_section)"/>
            <column name="content" value="Your pre-paid balance is below Water mark."/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(nms.id)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(id) from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(nml.id)+1 from notification_message_line nml)"/>
            <column name="message_section_id" valueComputed="(select max(id) from notification_message_section)"/>
            <column name="content" value="Dear $userSalutation,\r\n\r\nYour Pre-paid balance has reached below the credit limitation 1 mark of $creditNotificationLimit. Your balance is currently at $dynamicBalance.\r\n\r\nTherefore, you are kindly advised to make sufficient payment into your account as early as possible.\r\n\r\nThanks."/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(nms.id)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(id) from notification_message)"/>
            <column name="section" valueNumeric="3"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <!-- Content for the Credit Limitation 2 notification -->

        <insert tableName="notification_message">
            <column name="id" valueComputed="(select max(nm.id)+1 from notification_message nm)"/>
            <column name="type_id" valueComputed="  (select max(foreign_id) from international_description id
                                                    where id.table_id = 52
                                                        and id.psudo_column = 'description'
                                                        and id.language_id = 1
                                                        and id.content = 'Credit Limitation 2')"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="use_flag" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(nms.id)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(id) from notification_message)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(nml.id)+1 from notification_message_line nml)"/>
            <column name="message_section_id" valueComputed="(select max(id) from notification_message_section)"/>
            <column name="content" value="Your pre-paid balance is below Water mark."/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(nms.id)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(id) from notification_message)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(nml.id)+1 from notification_message_line nml)"/>
            <column name="message_section_id" valueComputed="(select max(id) from notification_message_section)"/>
            <column name="content" value="Dear $userSalutation,\r\n\r\nYour Pre-paid balance has reached below the credit limitation 2 mark of $creditNotificationLimit. Your balance is currently at $dynamicBalance.\r\n\r\nTherefore, you are kindly advised to make sufficient payment into your account as early as possible.\r\n\r\nThanks."/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(nms.id)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(id) from notification_message)"/>
            <column name="section" valueNumeric="3"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <update tableName="jbilling_seqs">
            <column name="next_id"  valueComputed="coalesce((select round(max(id)/100)+1 from notification_message), 1)"/>
            <where>name = 'notification_message'</where>
        </update>

        <update tableName="jbilling_seqs">
            <column name="next_id"  valueComputed="coalesce((select round(max(id)/100)+1 from notification_message_section), 1)"/>
            <where>name = 'notification_message_section'</where>
        </update>

        <update tableName="jbilling_seqs">
            <column name="next_id"  valueComputed="coalesce((select round(max(id)/100)+1 from notification_message_line), 1)"/>
            <where>name = 'notification_message_line'</where>
        </update>

        <update tableName="jbilling_seqs">
            <column name="next_id"  valueComputed="coalesce((select max(t.id)+1 from meta_field_name t), 1)"/>
            <where>name = 'meta_field_name'</where>
        </update>

        <update tableName="account_type">
            <column name="credit_notification_limit1" valueNumeric="100"/>
            <column name="credit_notification_limit2" valueNumeric="50"/>
            <where> id = 1 </where>
        </update>
    </changeSet>

    <changeSet author="Khobab" context="base" id="springbatch - #5336 - 1">
        <createTable tableName="batch_process_info">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="billing_process_info_pkey"/>
            </column>
            <column name="process_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="job_execution_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="total_failed_users" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="total_successful_users" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="Khobab" context="FKs" id="springbatch - #5336 - 2">
        <addForeignKeyConstraint baseColumnNames="process_id" baseTableName="batch_process_info" constraintName="batch_process_info_fk_1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="billing_process" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Khobab" context="base" id="springbatch - #5336 - 3">
        <createTable tableName="billing_process_failed_user">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="billing_process_failed_user_pkey"/>
            </column>
            <column name="batch_process_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet author="Khobab" context="FKs" id="springbatch - #5336 - 4">
        <addForeignKeyConstraint baseColumnNames="batch_process_id" baseTableName="billing_process_failed_user" constraintName="billing_process_failed_user_fk_1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="batch_process_info" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="billing_process_failed_user" constraintName="billing_process_failed_user_fk_2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="base_user" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Alexander Aksenov" context="base" id="#5447 - Development: Order Changes as Entities">
        <addColumn tableName="generic_status">
            <column name="ordr" type="java.sql.Types.INTEGER"/>
            <column name="attribute1" type="java.sql.Types.VARCHAR(20)"/>
            <column name="entity_id" type="java.sql.Types.INTEGER"/>
            <column name="deleted" type="java.sql.Types.INTEGER"/>
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="entity_id"
                                 baseTableName="generic_status"
                                 constraintName="generic_status_entity_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="entity"
                                 referencesUniqueColumn="false"/>

        <insert tableName="generic_status_type">
            <column name="id" value="order_change_status"/>
        </insert>

        <insert tableName="jbilling_table">
            <column name="id" valueComputed="(select max(t.id)+1 from jbilling_table t)"/>
            <column name="name" value="order_change_status"/>
        </insert>

        <insert tableName="generic_status">
            <column name="id" valueComputed="(select max(t.id)+1 from generic_status t)"/>
            <column name="dtype" value="order_change_status"/>
            <column name="status_value" valueNumeric="1"/>
            <column name="can_login"/>
            <column name="entity_id"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="ordr" valueNumeric="0"/>
            <column name="attribute1" value="NO"/>
        </insert>
        <insert tableName="generic_status">
            <column name="id" valueComputed="(select max(t.id)+1 from generic_status t)"/>
            <column name="dtype" value="order_change_status"/>
            <column name="status_value" valueNumeric="2"/>
            <column name="can_login"/>
            <column name="entity_id"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="ordr" valueNumeric="0"/>
            <column name="attribute1" value="NO"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select t.id from jbilling_table t where t.name = 'order_change_status')"/>
            <column name="foreign_id" valueNumeric="1"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="PENDING"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select t.id from jbilling_table t where t.name = 'order_change_status')"/>
            <column name="foreign_id" valueNumeric="2"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="APPLY ERROR"/>
        </insert>

        <insert tableName="jbilling_seqs">
            <column name="name" value="order_change_status"/>
            <column name="next_id" valueNumeric="3"/>
        </insert>
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(t.id)+1 from generic_status t)"/>
            <where>name='generic_status'</where>
        </update>

        <createTable tableName="order_change">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="order_change_pkey"/>
            </column>
            <column name="parent_order_change_id" type="java.sql.Types.INTEGER"/>
            <column name="parent_order_line_id" type="java.sql.Types.INTEGER"/>
            <column name="order_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="item_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="price" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="description" type="java.sql.Types.VARCHAR(1000)"/>
            <column name="use_item" type="java.sql.Types.INTEGER"/>
            <column name="user_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="create_datetime" type="java.sql.Types.TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="start_date" type="java.sql.Types.DATE">
                <constraints nullable="false"/>
            </column>
            <column name="application_date" type="java.sql.Types.TIMESTAMP"/>
            <column name="status_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="user_assigned_status_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="order_line_id" type="java.sql.Types.INTEGER"/>
            <column name="optlock" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="error_message" type="java.sql.Types.VARCHAR(500)"/>
            <column name="error_codes" type="java.sql.Types.VARCHAR(200)"/>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="order_id"
                                 baseTableName="order_change"
                                 constraintName="order_change_order_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="purchase_order"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="item_id"
                                 baseTableName="order_change"
                                 constraintName="order_change_item_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="item"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="user_id"
                                 baseTableName="order_change"
                                 constraintName="order_change_user_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="base_user"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="status_id"
                                 baseTableName="order_change"
                                 constraintName="order_change_status_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="generic_status"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="user_assigned_status_id"
                                 baseTableName="order_change"
                                 constraintName="order_change_user_status_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="generic_status"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="order_line_id"
                                 baseTableName="order_change"
                                 constraintName="order_change_order_line_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_line"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="parent_order_line_id"
                                 baseTableName="order_change"
                                 constraintName="order_change_parent_order_line_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_line"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="parent_order_change_id"
                                 baseTableName="order_change"
                                 constraintName="order_change_parent_order_change_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_change"
                                 referencesUniqueColumn="false"/>

        <createTable tableName="order_change_asset_map">
            <column name="order_change_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="asset_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseColumnNames="order_change_id"
                                 baseTableName="order_change_asset_map"
                                 constraintName="order_change_asset_map_change_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_change"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="asset_id"
                                 baseTableName="order_change_asset_map"
                                 constraintName="order_change_asset_map_asset_id_fk"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="asset"
                                 referencesUniqueColumn="false"/>

        <insert tableName="jbilling_table">
            <column name="id" valueComputed="(select max(t.id)+1 from jbilling_table t)"/>
            <column name="name" value="order_change"/>
        </insert>
        <insert tableName="jbilling_seqs">
            <column name="name" value="order_change"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueNumeric="3"/>
            <where>name='order_change_status'</where>
        </update>
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(t.id)+1 from generic_status t)"/>
            <where>name='generic_status'</where>
        </update>

        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueNumeric="22"/>
            <column name="class_name" value="com.sapienter.jbilling.server.order.task.OrderChangeUpdateTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <where>name='pluggable_task_type'</where>
        </update>
    </changeSet>

    <changeSet author="Alexander Aksenov" context="test" id="#5447 - Development: Order Changes as Entities, test changes">
        <insert tableName="generic_status">
            <column name="id" valueComputed="(select max(t.id)+1 from generic_status t)"/>
            <column name="dtype" value="order_change_status"/>
            <column name="status_value" valueNumeric="3"/>
            <column name="can_login"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="deleted" valueNumeric="0"/>
            <column name="ordr" valueNumeric="1"/>
            <column name="attribute1" value="YES"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueComputed="(select t.id from jbilling_table t where t.name = 'order_change_status')"/>
            <column name="foreign_id" valueNumeric="3"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="APPLY"/>
        </insert>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueNumeric="4"/>
            <where>name='order_change_status'</where>
        </update>
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(t.id)+1 from generic_status t)"/>
            <where>name='generic_status'</where>
        </update>

        <insert tableName="pluggable_task">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task t)"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="type_id" valueComputed="(select t.id from pluggable_task_type t where t.class_name = 'com.sapienter.jbilling.server.order.task.OrderChangeUpdateTask')"/>
            <column name="processing_order" valueNumeric="5"/>
            <column name="optlock" valueNumeric="1"/>
            <column name="notes" value=""/>
        </insert>
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(t.id)+1 from pluggable_task t)"/>
            <where>name='pluggable_task'</where>
        </update>
    </changeSet>

    <changeSet author="Gerhard Maree" context="base" id="#5449 - Integrate Product Meta Fields into Order Changes">
        <comment>Order Change Meta Fields</comment>
        <createTable tableName="order_change_meta_field_map">
            <column name="order_change_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="meta_field_value_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="order_change_id"
                                 baseTableName="order_change_meta_field_map"
                                 constraintName="order_change_meta_field_map_fk_1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_change"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="meta_field_value_id"
                                 baseTableName="order_change_meta_field_map"
                                 constraintName="order_change_meta_field_map_fk_2"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_value"
                                 referencesUniqueColumn="false"/>

        <comment>Order Line Meta Fields</comment>
        <createTable tableName="order_line_meta_field_map">
            <column name="order_line_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="meta_field_value_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="order_line_id"
                                 baseTableName="order_line_meta_field_map"
                                 constraintName="ol_meta_field_map_fk_1"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_line"
                                 referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="meta_field_value_id"
                                 baseTableName="order_line_meta_field_map"
                                 constraintName="ol_meta_field_map_fk_2"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_value"
                                 referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="Gerhard Maree" id="#6719 - User Codes - Entities" context="base">
        <createTable tableName="user_code">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="user_code_pkey"/>
            </column>
            <column name="user_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="java.sql.Types.VARCHAR(55)">
                <constraints nullable="false" unique="true" uniqueConstraintName="user_code_identifier_key" />
            </column>
            <column name="external_ref" type="java.sql.Types.VARCHAR(50)" />
            <column name="type" type="java.sql.Types.VARCHAR(50)" />
            <column name="type_desc" type="java.sql.Types.VARCHAR(250)" />
            <column name="valid_from" type="java.sql.Types.DATE" />
            <column name="valid_to" type="java.sql.Types.DATE" />
        </createTable>

        <insert tableName="jbilling_seqs">
            <column name="name" value="user_code"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>

        <createTable tableName="user_code_link">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="user_code_link_pkey"/>
            </column>
            <column name="user_code_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="object_type" type="java.sql.Types.VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="object_id" type="java.sql.Types.INTEGER" />
        </createTable>
        <insert tableName="jbilling_seqs">
            <column name="name" value="user_code_link"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>

        <sql>
            <![CDATA[
            INSERT INTO enumeration (id, entity_id, name, optlock)
            SELECT coalesce( (select max(id)+1 from enumeration),1)+e.id, e.id, 'User Code Type', 0 FROM entity e;

            ]]>
        </sql>
        
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(coalesce( (select max(id)+1 from enumeration),1) )"/>
            <where>name='enumeration'</where>
        </update>

    </changeSet>

	<changeSet author="Khobab Chaudhary" context="test" id="#6489 - Moved AIT Meta Fields To New Mapping Table">
    	<sql>
	    	insert into customer_account_info_type_timeline(id, customer_id, account_info_type_id, meta_field_value_id, effective_date) 
				select v.id, c.id, g.metafield_group_id, v.id, '1970-01-01' from meta_field_value v
				join meta_field_name n on v.meta_field_name_id = n.id
				join customer_meta_field_map map on map.meta_field_value_id = v.id
				join customer c on c.id = map.customer_id
				join metafield_group_meta_field_map g on g.meta_field_value_id = n.id
				where n.entity_type='ACCOUNT_TYPE' order by c.id;
				
			delete from customer_meta_field_map where meta_field_value_id in
				(select id from (select v.id from meta_field_value v
				join meta_field_name n on v.meta_field_name_id = n.id
				join customer_meta_field_map map on map.meta_field_value_id = v.id
				join customer c on c.id = map.customer_id
				join metafield_group_meta_field_map g on g.meta_field_value_id = n.id
				where n.entity_type='ACCOUNT_TYPE' order by c.id) as t);
    	</sql>
        <insert tableName="jbilling_seqs">
            <column name="name" value="customer_account_info_type_timeline"/>
            <column name="next_id" valueComputed="(select max(t.id)+1 from customer_account_info_type_timeline t)"/>
        </insert>
    </changeSet>
	
	<changeSet id="#6593-order-line-tiers" author="Bilal Nasir" context="base">
    	<createTable tableName="order_line_tier">
    		<column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="order_line_tier_pkey"/>
            </column>
            <column name="order_line_id" type="java.sql.Types.INTEGER"/>
            <column name="tier_number" type="java.sql.Types.INTEGER"/>
            <column name="quantity" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="price" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="amount" type="java.sql.Types.NUMERIC(22,10)"/>
    	</createTable>
    	
    	<addForeignKeyConstraint baseColumnNames="order_line_id" baseTableName="order_line_tier" constraintName="order_line_tier_fk_1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_line" referencesUniqueColumn="false"/>
    	
    	<insert tableName="jbilling_seqs">
            <column name="name" value="order_line_tier"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
        
    	<insert tableName="jbilling_table">
            <column name="id" valueComputed="(select max(T.id)+1 from jbilling_table T)"/>
            <column name="name" value="order_line_tier"/>
        </insert>
        
        <insert tableName="preference_type">
            <column name="id" valueComputed="(select max(T.id)+1 from preference_type T)"/>
            <column name="def_value" valueNumeric="0"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="50"/>
            <column name="foreign_id" valueComputed="(select max(T.id) from preference_type T)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Create Invoice Lines based on Order Line Tiers"/>
        </insert>
    </changeSet>		
    
    <changeSet id="#6652-olt-add-column" author="Amol Gadre" context="base"> 
		<addColumn tableName="order_line_tier">
        	<column name="tier_type" type="java.sql.Types.VARCHAR(100)">
				<constraints nullable="false"/>        		
        	</column>
    	</addColumn>    
    </changeSet>
    
	<changeSet id="#6652-order-add-column" author="Amol Gadre" context="base"> 
		<addColumn tableName="purchase_order">
        	<column name="free_usage_quantity" type="java.sql.Types.NUMERIC(22,10)"/>
		</addColumn>
	</changeSet>

	<changeSet author="Khobab" context="base" id="account-payment-information - #6315">
        <createTable tableName="payment_method_template">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="payment_method_template_pkey"/>
            </column>
            <column name="template_name" type="java.sql.Types.VARCHAR(20)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="OPTLOCK" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <createTable tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="meta_field_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <createTable tableName="payment_method_type">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="payment_method_type_pkey"/>
            </column>
            <column name="method_name" type="java.sql.Types.VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="is_recurring" type="java.sql.Types.Boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="entity_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="template_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="OPTLOCK" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <createTable tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="meta_field_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <createTable tableName="payment_information">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="payment_information_pkey"/>
            </column>
            <column name="user_id" type="java.sql.Types.INTEGER">
                <constraints nullable="true"/>
            </column>
            <column name="payment_method_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="processing_order" type="java.sql.Types.INTEGER">
                <constraints nullable="true"/>
            </column>
            <column name="deleted" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="OPTLOCK" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <createTable tableName="payment_information_meta_fields_map">
            <column name="payment_information_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="meta_field_value_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <createTable tableName="payment_method_account_type_map">
            <column name="payment_method_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="account_type_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <addForeignKeyConstraint baseColumnNames="method_template_id" baseTableName="payment_method_template_meta_fields_map" constraintName="payment_method_template_meta_fields_map_FK1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_method_template"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="meta_field_id" baseTableName="payment_method_template_meta_fields_map" constraintName="payment_method_template_meta_fields_map_FK2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_name"  referencesUniqueColumn="false"/>
    	
    	<addForeignKeyConstraint baseColumnNames="entity_id" baseTableName="payment_method_type" constraintName="payment_method_type_FK1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="entity"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="template_id" baseTableName="payment_method_type" constraintName="payment_method_type_FK2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_method_template"  referencesUniqueColumn="false"/>
    	
    	<addForeignKeyConstraint baseColumnNames="payment_method_id" baseTableName="payment_method_meta_fields_map" constraintName="payment_method_meta_fields_map_FK1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_method_type"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="meta_field_id" baseTableName="payment_method_meta_fields_map" constraintName="payment_method_meta_fields_map_FK2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_name"  referencesUniqueColumn="false"/>
    	
    	<addForeignKeyConstraint baseColumnNames="user_id" baseTableName="payment_information" constraintName="payment_information_FK1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="base_user"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="payment_method_id" baseTableName="payment_information" constraintName="payment_information_FK2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_method_type"  referencesUniqueColumn="false"/>
    	
    	<addForeignKeyConstraint baseColumnNames="payment_information_id" baseTableName="payment_information_meta_fields_map" constraintName="payment_information_meta_fields_map_FK1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_information"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="meta_field_value_id" baseTableName="payment_information_meta_fields_map" constraintName="payment_information_meta_fields_map_FK2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meta_field_value"  referencesUniqueColumn="false"/>
    	
    	<addForeignKeyConstraint baseColumnNames="payment_method_id" baseTableName="payment_method_account_type_map" constraintName="payment_method_account_type_map_FK1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_method_type"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="account_type_id" baseTableName="payment_method_account_type_map" constraintName="payment_method_account_type_map_FK2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="account_type"  referencesUniqueColumn="false"/>
    	
    	<insert tableName="jbilling_seqs">
            <column name="name" value="payment_method_template"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
        
        <insert tableName="jbilling_seqs">
            <column name="name" value="payment_method_type"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
        
        <insert tableName="jbilling_seqs">
            <column name="name" value="payment_information"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
        
        <insert tableName="payment_method_template">
            <column name="id" valueComputed="(select coalesce(max(pm.id)+1,1) from payment_method_template pm)"/>
            <column name="template_name" value="Payment Card"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
                
        <insert tableName="payment_method_template">
            <column name="id" valueComputed="(select max(pm.id)+1 from payment_method_template pm)"/>
            <column name="template_name" value="ACH"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="payment_method_template">
            <column name="id" valueComputed="(select max(pm.id)+1 from payment_method_template pm)"/>
            <column name="template_name" value="Cheque"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
                 
        <!-- we will have to drop payment method column and of payment table -->
        <dropNotNullConstraint columnName="method_id" tableName="payment" columnDataType="java.sql.Types.INTEGER" />
        
        <createTable tableName="payment_instrument_info">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="payment_instrument_info_pkey"/>
            </column>
            <column name="result_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="method_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="instrument_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="payment_id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <insert tableName="jbilling_seqs">
            <column name="name" value="payment_instrument_info"/>
            <column name="next_id" valueNumeric="1"/>
        </insert>
        
        <addForeignKeyConstraint baseColumnNames="result_id" baseTableName="payment_instrument_info" constraintName="payment_instrument_info_FK1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_result"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="method_id" baseTableName="payment_instrument_info" constraintName="payment_instrument_info_FK2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_method"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="instrument_id" baseTableName="payment_instrument_info" constraintName="payment_instrument_info_FK3" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_information"  referencesUniqueColumn="false"/>
    	<addForeignKeyConstraint baseColumnNames="payment_id" baseTableName="payment_instrument_info" constraintName="payment_instrument_info_FK4" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment"  referencesUniqueColumn="false"/>
    
    </changeSet>
    
    <changeSet author="Khobab" context="test" id="account-payment-information-migration-script - #6315">
    	<!-- In case we are running test changeset we will need payment method template meta fields -->
    	<!-- Credit Card payment method meta fields -->
    	<insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="cc.cardholder.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
        </insert>
        
       	<insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="TITLE" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select coalesce(max(t.id)+1,1) from validation_rule t)"/>
            <column name="rule_type" value="PAYMENT_CARD"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Payment card number is not valid"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="cc.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="2"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="PAYMENT_CARD_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select max(t.id)+1 from validation_rule t)"/>
            <column name="rule_type" value="REGEX"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="cc.expiry.date"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="3"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="DATE" />
        </insert>
        
        <insert tableName="validation_rule_attributes">
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="attribute_name" value="regularExpression"/>
            <column name="attribute_value" value="(?:0[1-9]|1[0-2])/[0-9]{4}"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Expiry date should be in format MM/yyyy"/>
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="cc.gateway.key"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="true"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="4"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
            <column name="validation_rule_id"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="GATEWAY_KEY" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="cc.type"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="INTEGER"/>
            <column name="is_disabled" valueBoolean="true"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="5"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
            <column name="validation_rule_id"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="CC_TYPE" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
    	<!-- Ach template meta fields -->
    	<insert tableName="validation_rule">
            <column name="id" valueComputed="(select max(t.id)+1 from validation_rule t)"/>
            <column name="rule_type" value="REGEX"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="validation_rule_attributes">
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="attribute_name" value="regularExpression"/>
            <column name="attribute_value" value="[0-9]+"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="ABA Routing or Bank Account Number can only be digits"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="ach.routing.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_ROUTING_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'ACH')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="ach.customer.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="2"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="TITLE" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'ACH')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="ach.account.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="3"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_ACCOUNT_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'ACH')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="ach.bank.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="4"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_NAME" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'ACH')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="ach.account.type"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="ENUMERATION"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="5"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_ACCOUNT_TYPE" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'ACH')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="enumeration">
            <column name="id" valueComputed="(select max(t.id)+1 from enumeration t)"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
            <column name="name" value="ach.account.type"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        <insert tableName="enumeration_values">
            <column name="id" valueComputed="(select max(t.id)+1 from enumeration_values t)"/>
            <column name="enumeration_id" valueComputed="(select max(t.id) from enumeration t)"/>
            <column name="value" value="CHECKING"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        <insert tableName="enumeration_values">
            <column name="id" valueComputed="(select max(t.id)+1 from enumeration_values t)"/>
            <column name="enumeration_id" valueComputed="(select max(t.id) from enumeration t)"/>
            <column name="value" value="SAVINGS"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="ach.gateway.key"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="true"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="4"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
            <column name="validation_rule_id"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="GATEWAY_KEY" />
        </insert>
        
         <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'ACH')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <!-- cheque template meta fields -->
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="cheque.bank.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_NAME" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Cheque')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="cheque.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="2"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="CHEQUE_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Cheque')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(select max(t.id)+1 from meta_field_name t)"/>
            <column name="name" value="cheque.date"/>
            <column name="entity_type" value="PAYMENT_METHOD_TEMPLATE"/>
            <column name="data_type" value="DATE"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="3"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(t.id) from entity t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="DATE" />
        </insert>
        
        <insert tableName="payment_method_template_meta_fields_map">
            <column name="method_template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Cheque')"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
    	<insert tableName="payment_method_type">
    		<!-- This payment method will be used in testing, we want it to have fixed id -->
            <column name="id" valueNumeric="1"/>
            <column name="method_name" value="Credit Card"/>
            <column name="is_recurring" valueBoolean="true"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.cardholder.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        
       	<insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="TITLE" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select coalesce(max(v.id)+1,1) from validation_rule v)"/>
            <column name="rule_type" value="PAYMENT_CARD"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Payment card number is not valid"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="2"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="PAYMENT_CARD_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select max(t.id)+1 from validation_rule t)"/>
            <column name="rule_type" value="REGEX"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.expiry.date"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="3"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="DATE" />
        </insert>
        
        <insert tableName="validation_rule_attributes">
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="attribute_name" value="regularExpression"/>
            <column name="attribute_value" value="(?:0[1-9]|1[0-2])/[0-9]{4}"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Expiry date should be in format MM/yyyy"/>
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.gateway.key"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="true"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="4"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
            <column name="validation_rule_id"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="GATEWAY_KEY" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.type"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="INTEGER"/>
            <column name="is_disabled" valueBoolean="true"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="5"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
            <column name="validation_rule_id"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="CC_TYPE" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="payment_method_type">
    		<!-- This payment method will be used in testing, we want it to have fixed id -->
            <column name="id" valueNumeric="2"/>
            <column name="method_name" value="ACH"/>
            <column name="is_recurring" valueBoolean="true"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'ACH')"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        
        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select max(t.id)+1 from validation_rule t)"/>
            <column name="rule_type" value="REGEX"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="validation_rule_attributes">
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="attribute_name" value="regularExpression"/>
            <column name="attribute_value" value="[0-9]+"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="ABA Routing or Bank Account Number can only be digits"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="ach.routing.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_ROUTING_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="ach.customer.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="2"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="TITLE" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="ach.account.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="3"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_ACCOUNT_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="ach.bank.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="4"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_NAME" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="ach.account.type"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="ENUMERATION"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="5"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_ACCOUNT_TYPE" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="enumeration">
            <column name="id" valueComputed="(select max(t.id)+1 from enumeration t)"/>
            <column name="entity_id" valueComputed="(select min(id) from entity)"/>
            <column name="name" value="ach.account.type"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        <insert tableName="enumeration_values">
            <column name="id" valueComputed="(select max(t.id)+1 from enumeration_values t)"/>
            <column name="enumeration_id" valueComputed="(select max(t.id) from enumeration t)"/>
            <column name="value" value="CHECKING"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        <insert tableName="enumeration_values">
            <column name="id" valueComputed="(select max(t.id)+1 from enumeration_values t)"/>
            <column name="enumeration_id" valueComputed="(select max(t.id) from enumeration t)"/>
            <column name="value" value="SAVINGS"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="ach.gateway.key"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="true"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="4"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="validation_rule_id"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="GATEWAY_KEY" />
        </insert>
        
         <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="payment_method_type">
    		<!-- This payment method will be used in testing, we want it to have fixed id -->
            <column name="id" valueNumeric="3"/>
            <column name="method_name" value="Cheque"/>
            <column name="is_recurring" valueBoolean="false"/>
            <column name="entity_id" valueNumeric="1"/>
            <column name="template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Cheque')"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
    	
    	<insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cheque.bank.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="BANK_NAME" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cheque.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="2"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="CHEQUE_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cheque.date"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="DATE"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="3"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueNumeric="1"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="DATE" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <!-- create credit card payment method type for reseller company -->
        
        <insert tableName="payment_method_type">
    		<!-- This payment method will be used in testing, we want it to have fixed id -->
            <column name="id" valueNumeric="4"/>
            <column name="method_name" value="Credit Card"/>
            <column name="is_recurring" valueBoolean="true"/>
            <column name="entity_id" valueNumeric="3"/>
            <column name="template_id" valueComputed="(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')"/>
            <column name="optlock" valueNumeric="1"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.cardholder.name"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="1"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueNumeric="3"/>
        </insert>
        
       	<insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="TITLE" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select coalesce(max(t.id)+1,1) from validation_rule t)"/>
            <column name="rule_type" value="PAYMENT_CARD"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Payment card number is not valid"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.number"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="2"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="3"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="PAYMENT_CARD_NUMBER" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select max(t.id)+1 from validation_rule t)"/>
            <column name="rule_type" value="REGEX"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.expiry.date"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="false"/>
            <column name="is_mandatory" valueBoolean="true"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="3"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="3"/>
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="DATE" />
        </insert>
        
        <insert tableName="validation_rule_attributes">
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="attribute_name" value="regularExpression"/>
            <column name="attribute_value" value="(?:0[1-9]|1[0-2])/[0-9]{4}"/>
        </insert>
        
        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Expiry date should be in format MM/yyyy"/>
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.gateway.key"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="STRING"/>
            <column name="is_disabled" valueBoolean="true"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="4"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="3"/>
            <column name="validation_rule_id"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="GATEWAY_KEY" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
        <insert tableName="meta_field_name">
            <column name="id" valueComputed="(coalesce((select max(mn.id)+1 from meta_field_name mn), 1))"/>
            <column name="name" value="cc.type"/>
            <column name="entity_type" value="PAYMENT_METHOD_TYPE"/>
            <column name="data_type" value="INTEGER"/>
            <column name="is_disabled" valueBoolean="true"/>
            <column name="is_mandatory" valueBoolean="false"/>
            <column name="is_primary" valueBoolean="true"/>
            <column name="display_order" valueNumeric="5"/>
            <column name="default_value_id"/>
            <column name="optlock" valueNumeric="0"/>
            <column name="entity_id" valueComputed="3"/>
            <column name="validation_rule_id"/>
        </insert>
        
        <insert tableName="metafield_type_map">
            <column name="metafield_id" valueComputed="(select max(mfn.id) from meta_field_name mfn)" />
            <column name="field_usage" value="CC_TYPE" />
        </insert>
        
        <insert tableName="payment_method_meta_fields_map">
            <column name="payment_method_id" valueComputed="(select max(t.id) from payment_method_type t)"/>
            <column name="meta_field_id" valueComputed="(select max(t.id) from meta_field_name t)"/>
        </insert>
        
    	<!-- Moves data from credit_card, payment_info_cheque and ach tables to payment_information_table, also updates foreign keys -->
   		<customChange class="com.sapienter.jbilling.server.migrations.MigratePaymentInstruments" />
   		<dropForeignKeyConstraint baseTableName="payment" constraintName="payment_fk_4"/>
        <addForeignKeyConstraint baseColumnNames="credit_card_id"
                                  baseTableName="payment" constraintName="payment_fk_7"
                                  deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                  onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="payment_information"
                                  referencesUniqueColumn="false" />
   		
   		<dropForeignKeyConstraint baseTableName="payment" constraintName="payment_fk_1"/>
   		<dropColumn columnName="ach_id" tableName="payment"/>
   		<dropTable tableName="credit_card"/>
   		<dropTable tableName="ach"/>
   		<dropTable tableName="payment_info_cheque"/>
            
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(p.id)+1 from payment_information p)"/>
            <where>name='payment_information'</where>
        </update>
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(p.id)+1 from payment_method_type p)"/>
            <where>name='payment_method_type'</where>
        </update>
        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(t.id)+1 from payment_instrument_info t)"/>
            <where>name='payment_instrument_info'</where>
        </update>
    </changeSet>

	<changeSet id="#7308-usage-pool-consumption-notification" author="Amol Gadre" context="base">
        <insert tableName="notification_message_type">
            <column name="id" valueComputed="(select max(nmt.id)+1 from notification_message_type nmt)"/>
            <column name="category_id" valueNumeric="4"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
		<insert tableName="international_description">
            <column name="table_id" valueNumeric="52"/>
            <column name="foreign_id" valueComputed="(select max(nmt.id) from notification_message_type nmt)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Usage Pool Consumption"/>
        </insert>
        
		<update tableName="jbilling_seqs">
            <column name="next_id"  valueComputed="coalesce((select round(max(id)/100)+1 from notification_message), 1)"/>
            <where>name = 'notification_message'</where>
        </update>
        
		<update tableName="jbilling_seqs">
            <column name="next_id"  valueComputed="coalesce((select round(max(id)/100)+1 from notification_message_section), 1)"/>
            <where>name = 'notification_message_section'</where>
        </update>
        
        <update tableName="jbilling_seqs">
            <column name="next_id"  valueComputed="coalesce((select round(max(id)/100)+1 from notification_message_line), 1)"/>
            <where>name = 'notification_message_line'</where>
        </update>
	</changeSet>
	
	<changeSet id="#7308-usage-pool-consumption-notification-test" author="Amol Gadre" context="base">
		<sql>
            <![CDATA[
                   INSERT INTO notification_message (id, type_id, entity_id, language_id, use_flag, optlock)
                   select (select COALESCE(max(nm.id),0)+1 from notification_message nm) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                          (select foreign_id from international_description where table_id=52 and content='Usage Pool Consumption'),
                          e1.id,
                          1,
                          1,
                          0
                   from entity e1
                   order by e1.id
               ]]>
        </sql>
        
		<insert tableName="notification_message_section">
            <column name="id" valueComputed="(select COALESCE(max(nms.id),0)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(n.id) from notification_message n)"/>
            <column name="section" valueNumeric="1"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
		<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select COALESCE(max(nml.id),0)+1 from notification_message_line nml)"/>
            <column name="message_section_id" valueComputed="(select max(n.id) from notification_message_section n)"/>
            <column name="content" value="Usage pool consumption status."/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
		<insert tableName="notification_message_section">
            <column name="id" valueComputed="(select COALESCE(max(nms.id),0)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(n.id) from notification_message n)"/>
            <column name="section" valueNumeric="2"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
		<insert tableName="notification_message_line">
            <column name="id" valueComputed="(select max(nml.id)+1 from notification_message_line nml)"/>
            <column name="message_section_id" valueComputed="(select max(n.id) from notification_message_section n)"/>
            <column name="content" value="Dear $userSalutation,\r\n\r\nYou have used $percentageConsumption% from Free Usage Pool - $usagePoolName.\r\n\r\nThanks."/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
        
		<insert tableName="notification_message_section">
            <column name="id" valueComputed="(select max(nms.id)+1 from notification_message_section nms)"/>
            <column name="message_id" valueComputed="(select max(n.id) from notification_message n)"/>
            <column name="section" valueNumeric="3"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>
	</changeSet>
		
	<changeSet id="#7659-Free-Usage-Pool-Consumption-enhancements" author="Marco Manzi" context="base">
	
		<createTable tableName="notification_medium_type">
			<column name="notification_id" type="java.sql.Types.INTEGER">
				<constraints nullable="false" primaryKey="true" />
			</column>
			<column name="medium_type" type="java.sql.Types.VARCHAR(255)">
				<constraints nullable="false" primaryKey="true" />
			</column>
		</createTable>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="1" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="1" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="1" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="2" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="2" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="2" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="3" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="3" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="3" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="4" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="4" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="4" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="7" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="7" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="7" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="8" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="8" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="8" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="9" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="9" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="9" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="10" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="10" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="10" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="11" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="11" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="11" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="12" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="12" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="12" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="13" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="13" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="13" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="14" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="14" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="14" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="15" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="15" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="15" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="17" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="17" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="17" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="18" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="18" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="18" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="19" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="19" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="19" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="16" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="16" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="16" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="20" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="20" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="20" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="21" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="21" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="21" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="22" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="22" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="22" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="23" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="23" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="23" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="24" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="24" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="24" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="25" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="25" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="25" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="26" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="26" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="26" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="27" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="27" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="27" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="28" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="28" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="28" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="29" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="29" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="29" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="30" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="30" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="30" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="31" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="31" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="31" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="32" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="32" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="32" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="33" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="33" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="33" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="34" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="34" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="34" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="35" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="35" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="35" />
			<column name="medium_type" value="PDF" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="36" />
			<column name="medium_type" value="SMS" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="36" />
			<column name="medium_type" value="EMAIL" />
		</insert>
		<insert tableName="notification_medium_type">
			<column name="notification_id" valueNumeric="36" />
			<column name="medium_type" value="PDF" />
		</insert>
	
	</changeSet>
	
	<changeSet context="test" author="Rohit" id="20140308-#5455-Customizable-Statuses-Requirements">
        <insert tableName="order_status">
            <column name="id" valueNumeric="5"/>
            <column name="order_status_flag" valueNumeric="0"/> <!-- INVOICE -->
            <column name="entity_id" valueNumeric="3"/>
        </insert>
        <insert tableName="order_status">
            <column name="id" valueNumeric="6"/>
            <column name="order_status_flag" valueNumeric="1"/> <!-- FINISHED -->
            <column name="entity_id" valueNumeric="3"/>
        </insert>
        <insert tableName="order_status">
            <column name="id" valueNumeric="7"/>
            <column name="order_status_flag" valueNumeric="2"/> <!-- NOT_INVOICE -->
            <column name="entity_id" valueNumeric="3"/>
        </insert>
        <insert tableName="order_status">
            <column name="id" valueNumeric="8"/>
            <column name="order_status_flag" valueNumeric="3"/> <!-- AGEING_SUSPENDED -->
            <column name="entity_id" valueNumeric="3"/>
        </insert>
     </changeSet>

	<changeSet id="#7308-fup-consumption-notification-fix1" author="Vishwajeet Borade" context="base">
		<sql>
            <![CDATA[
                INSERT INTO notification_message_section (id, message_id, section, optlock)
                select (select max(p.id)+1 from notification_message_section p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       (select max(p.id) from notification_message p) - (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       1,
                       1
                from entity e1
                order by e1.id
            ]]>
		</sql>
	</changeSet>

	<changeSet id="#7308-fup-consumption-notification-fix2" author="Vishwajeet Borade" context="base">
		<sql>
            <![CDATA[
                INSERT INTO notification_message_section (id, message_id, section, optlock)
                select (select max(p.id)+1 from notification_message_section p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       (select max(p.id) from notification_message p) - (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       2,
                       1
                from entity e1
                order by e1.id
            ]]>
		</sql>
	</changeSet>

	<changeSet id="#7308-fup-consumption-notification-fix3" author="Vishwajeet Borade" context="base">
		<sql>
            <![CDATA[
                INSERT INTO notification_message_section (id, message_id, section, optlock)
                select (select max(p.id)+1 from notification_message_section p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       (select max(p.id) from notification_message p) - (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       3,
                       1
                from entity e1
                order by e1.id
            ]]>
		</sql>
	</changeSet>

	<changeSet id="#7308-fup-consumption-notification-fix4" author="Vishwajeet Borade" context="base">
		<sql>
            <![CDATA[
                INSERT INTO notification_message_line (id, message_section_id, content, optlock)
                select (select max(p.id)+1 from notification_message_line p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       (select max(p.id)+1 from notification_message_section p) - (select count(*) * 3 from entity ecant) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       'Usage pool consumption status.',
                       1
                from entity e1
                order by e1.id
            ]]>
		</sql>
	</changeSet>

	<changeSet id="#7308-fup-consumption-notification-fix5" author="Vishwajeet Borade" context="base">
		<sql>
            <![CDATA[
                INSERT INTO notification_message_line (id, message_section_id, content, optlock)
                select (select max(p.id)+1 from notification_message_line p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       (select max(p.id)+1 from notification_message_section p) - (select count(*) * 2 from entity ecant) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       'Dear $userSalutation, You have used $percentageConsumption% from Free Usage Pool - $usagePoolName. Thanks.',
                       1
                from entity e1
                order by e1.id
            ]]>
		</sql>
	</changeSet>
	
	<changeSet id="#7308-fup-consumption-notification-fix6" author="Vishwajeet Borade" context="base">
		<sql>
            <![CDATA[
                INSERT INTO notification_message_line (id, message_section_id, content, optlock)
                select (select max(p.id)+1 from notification_message_line p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       (select max(p.id)+1 from notification_message_section p) - (select count(*) * 1 from entity ecant) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                       'Dear $userSalutation,<p>You have used $percentageConsumption% from Free Usage Pool - $usagePoolName.<p>Thanks.',
                       1
                from entity e1
                order by e1.id
            ]]>
		</sql>
	</changeSet>
	
	<changeSet id="#8048-usercodes-unique-per-company" author="Nelson Secchi" context="base">
        <dropUniqueConstraint tableName="user_code" constraintName="user_code_identifier_key" uniqueColumns="identifier"/>
    </changeSet>

    <changeSet id="7043 - Agents and Commissions" author="Oscar Bidabehere" context="base">
        <validCheckSum>3:17529cfb39c5e942f85b70b57d70745a</validCheckSum>
        <comment>Add partnerType, partner.parentId, standard and master percentages</comment>
        <addColumn tableName="partner">
            <column name="type" type="java.sql.Types.VARCHAR(250)"/>
        </addColumn>
        <addColumn tableName="partner">
            <column name="parent_id" type="java.sql.Types.INTEGER"/>
        </addColumn>
        <addColumn tableName="item">
            <column name="standard_partner_percentage" type="java.sql.Types.NUMERIC(22,10)"/>
        </addColumn>
        <addColumn tableName="item">
            <column name="master_partner_percentage" type="java.sql.Types.NUMERIC(22,10)"/>
        </addColumn>

        <comment>Add commission exception</comment>
        <createTable tableName="partner_commission_exception">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="partner_id" type="java.sql.Types.INTEGER"/>
            <column name="start_date" type="java.sql.Types.DATE"/>
            <column name="end_date" type="java.sql.Types.DATE"/>
            <column name="percentage" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="item_id" type="java.sql.Types.INTEGER"/>
        </createTable>

        <comment>Add referral commission</comment>
        <createTable tableName="partner_referral_commission">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="referral_id" type="java.sql.Types.INTEGER"/>
            <column name="referrer_id" type="java.sql.Types.INTEGER"/>
            <column name="start_date" type="java.sql.Types.DATE"/>
            <column name="end_date" type="java.sql.Types.DATE"/>
            <column name="percentage" type="java.sql.Types.NUMERIC(22,10)"/>
        </createTable>

        <comment>Add agent commission type property</comment>
        <addColumn tableName="partner">
            <column name="commission_type" type="java.sql.Types.VARCHAR(255)"/>
        </addColumn>

        <comment>Create partner commission</comment>
        <createTable tableName="partner_commission">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="amount" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="type" type="java.sql.Types.VARCHAR(255)"/>
            <column name="partner_id" type="java.sql.Types.INTEGER"/>
            <column name="commission_process_run_id" type="java.sql.Types.INTEGER"/>
        </createTable>

        <comment>Create commission run</comment>
        <createTable tableName="partner_commission_process_run">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="run_date" type="java.sql.Types.DATE"/>
            <column name="period_start" type="java.sql.Types.DATE"/>
            <column name="period_end" type="java.sql.Types.DATE"/>
            <column name="entity_id" type="java.sql.Types.INTEGER"/>
        </createTable>

        <comment>Create invoice commission</comment>
        <createTable tableName="invoice_commission">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="partner_id" type="java.sql.Types.INTEGER"/>
            <column name="referral_partner_id" type="java.sql.Types.INTEGER"/>
            <column name="commission_process_run_id" type="java.sql.Types.INTEGER"/>
            <column name="invoice_id" type="java.sql.Types.INTEGER"/>
            <column name="standard_amount" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="master_amount" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="exception_amount" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="referral_amount" type="java.sql.Types.NUMERIC(22,10)"/>
            <column name="commission_id" type="java.sql.Types.INTEGER"/>
        </createTable>

        <comment>Create payment commission</comment>
        <createTable tableName="payment_commission">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="invoice_id" type="java.sql.Types.INTEGER"/>
            <column name="payment_amount" type="java.sql.Types.NUMERIC(22,10)"/>
        </createTable>

        <comment>Agent commission schedule task</comment>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="coalesce((select max(p.id)+1 from pluggable_task_type p),1)"/>
            <column name="category_id" valueNumeric="22"/>
            <column name="class_name" value="com.sapienter.jbilling.server.user.partner.task.CalculateCommissionTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Calculate Agents' Commissions"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="This task schedules the process that calculates the Agents' Commissions."/>
        </insert>

        <comment>Agent commission process plugin category</comment>
        <insert tableName="pluggable_task_type_category">
            <column name="id" valueNumeric="25"/>
            <column name="interface_name"
                    value="com.sapienter.jbilling.server.user.partner.task.IPartnerCommissionTask"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="23"/>
            <column name="foreign_id" valueComputed="25"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Agent Commission Calculation Process."/>
        </insert>

        <comment>Create commission process configuration</comment>
        <createTable tableName="partner_commission_proc_config">
            <column name="id" type="java.sql.Types.INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="entity_id" type="java.sql.Types.INTEGER"/>
            <column name="next_run_date" type="java.sql.Types.DATE"/>
            <column name="period_unit_id" type="java.sql.Types.INTEGER"/>
            <column name="period_value" type="java.sql.Types.INTEGER"/>
        </createTable>

        <comment>Basic agent commission process plugin implementation</comment>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="coalesce((select max(p.id)+1 from pluggable_task_type p),1)"/>
            <column name="category_id" valueNumeric="25"/>
            <column name="class_name"
                    value="com.sapienter.jbilling.server.user.partner.task.BasicPartnerCommissionTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Basic Agents' Commissions task"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="This task calculates the Agents' Commissions."/>
        </insert>

        <comment>Add basic commission plugin to all entities</comment>
        <sql>
            <![CDATA[
                   INSERT INTO pluggable_task (id, entity_id, type_id, processing_order, optlock)
                   select (select max(p.id)+1 from pluggable_task p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                          e1.id,
                          (select max(p.id) from pluggable_task_type p),
                          1,
                          1
                   from entity e1
                   order by e1.id
               ]]>
        </sql>

        <comment>Event listener to create payment commissions</comment>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(p.id)+1 from pluggable_task_type p)"/>
            <column name="category_id" valueNumeric="17"/>
            <column name="class_name"
                    value="com.sapienter.jbilling.server.payment.tasks.GeneratePaymentCommissionTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Generate payment commissions for agents."/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(p.id) from pluggable_task_type p)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content"
                    value="This plug-in will create payment commissions when payments are linked an unlinked from invoices."/>
        </insert>

        <comment>Add payment commission plugin to all entities</comment>
        <sql>
            <![CDATA[
                   INSERT INTO pluggable_task (id, entity_id, type_id, processing_order, optlock)
                   select (select max(p.id)+1 from pluggable_task p) + (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id),
                          e1.id,
                          (select max(p.id) from pluggable_task_type p),
                          1,
                          1
                   from entity e1
                   order by e1.id
               ]]>
        </sql>

        <!--Old Code Clean-up-->
        <dropColumn tableName="partner" columnName="one_time"/>
        <dropColumn tableName="partner" columnName="automatic_process"/>
        <dropColumn tableName="partner" columnName="next_payout_date"/>
        <dropColumn tableName="partner" columnName="period_value"/>
        <dropForeignKeyConstraint baseTableName="partner" constraintName="partner_fk_1" />
        <dropColumn tableName="partner" columnName="period_unit_id"/>
        <dropForeignKeyConstraint baseTableName="partner" constraintName="partner_fk_2" />
        <dropColumn tableName="partner" columnName="fee_currency_id"/>
        <dropColumn tableName="partner" columnName="percentage_rate"/>
        <dropColumn tableName="partner" columnName="referral_fee"/>
        <dropColumn tableName="partner" columnName="balance"/>
        <dropForeignKeyConstraint baseTableName="partner" constraintName="partner_fk_3" />
        <dropColumn tableName="partner" columnName="related_clerk"/>
        <dropTable tableName="partner_range"/>
    </changeSet>
    
    <changeSet author="Marco Manzi" context="base" id="Source Readers: pluggable tasks">
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueNumeric="22"/>
            <column name="class_name" value="com.sapienter.jbilling.server.process.task.FtpRemoteCopyTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueNumeric="22"/>
            <column name="class_name" value="com.sapienter.jbilling.server.process.task.FtpsRemoteCopyTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueNumeric="22"/>
            <column name="class_name" value="com.sapienter.jbilling.server.process.task.StpRemoteCopyTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>
    </changeSet>

    <changeSet author="Marco Manzi" context="base" id="Source Readers: file exchange plugin">
        <delete tableName="pluggable_task_type">
            <where>class_name = 'com.sapienter.jbilling.server.process.task.StpRemoteCopyTask' and category_id = 22</where>
        </delete>
        <delete tableName="pluggable_task_type">
            <where>class_name = 'com.sapienter.jbilling.server.process.task.FtpsRemoteCopyTask' and category_id = 22</where>
        </delete>
        <delete tableName="pluggable_task_type">
            <where>class_name = 'com.sapienter.jbilling.server.process.task.FtpRemoteCopyTask' and category_id = 22</where>
        </delete>
        <insert tableName="pluggable_task_type_category">
            <column name="id" valueComputed="26"/>
            <column name="interface_name" value="com.sapienter.jbilling.server.process.task.IFileExchangeTask"/>
        </insert>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueNumeric="26"/>
            <column name="class_name" value="com.sapienter.jbilling.server.process.task.FtpRemoteCopyTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueNumeric="26"/>
            <column name="class_name" value="com.sapienter.jbilling.server.process.task.FtpsRemoteCopyTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>
        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueNumeric="26"/>
            <column name="class_name" value="com.sapienter.jbilling.server.process.task.StpRemoteCopyTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>
        <insert tableName="international_description">
            <column name="table_id" valueNumeric="23"/>
            <column name="foreign_id" valueNumeric="26"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Files exchange with remote locations, upload and download"/>
        </insert>

    </changeSet>

	 <changeSet author="Khobab Chaudhary" context="base" id="#7514 - Plans Enhancement">
     
     <addColumn tableName="item">
         <column name="active_since" type="java.sql.Types.DATE">
         	<constraints nullable="true" />
         </column>
     </addColumn>
     
     <addColumn tableName="item">
         <column name="active_until" type="java.sql.Types.DATE">
         	<constraints nullable="true" />
         </column>
     </addColumn>
     
     <addColumn tableName="item_type">
         <column name="one_per_order" type="java.sql.Types.BOOLEAN" defaultValueBoolean="false">
         	<constraints nullable="false" />
         </column>
     </addColumn>
     
     <addColumn tableName="item_type">
         <column name="one_per_customer" type="java.sql.Types.BOOLEAN" defaultValueBoolean="false">
         	<constraints nullable="false" />
         </column>
     </addColumn>
	</changeSet>

    <changeSet author="Vivek Sadh" context="post_base" id="1234567891234">
        <addForeignKeyConstraint baseColumnNames="status_id" baseTableName="purchase_order" constraintName="purchase_order_statusId_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="order_status" referencesUniqueColumn="false"/>
    </changeSet>
    
    <changeSet author="Vladimir Carevski" id="#6266-file-exchange-trigger">

        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(t.id)+1 from pluggable_task_type t)"/>
            <column name="category_id" valueComputed="22"/>
            <column name="class_name" value="com.sapienter.jbilling.server.process.task.FileExchangeTriggerTask"/>
            <column name="min_parameters" valueNumeric="1"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(t.id) from pluggable_task_type t)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Trigger File Download/Upload"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(t.id) from pluggable_task_type t)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Triggers File Download/Upload against third party system"/>
        </insert>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(p.id)+1 from pluggable_task_type p)"/>
            <where>name='pluggable_task_type'</where>
        </update>

    </changeSet>
    
    <changeSet author="Umer Aziz Malik" context="test, client" id="#8099 - Account-Payment-Information migration script fix">
        <!-- 'Payment Card' payment method template insertions & mappings -->
        
        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select e1.id + coalesce((select max(t.id)+1 from meta_field_name t), 1) as id,
				'cc.cardholder.name',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				1,
				0,
				e1.id
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'cc.cardholder.name' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
				select (select mfn.id), 'TITLE' from meta_field_name mfn WHERE mfn.name='cc.cardholder.name' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id), (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')
			from meta_field_name mfn WHERE mfn.name='cc.cardholder.name'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select coalesce(max(v.id)+1,1) from validation_rule v)"/>
            <column name="rule_type" value="PAYMENT_CARD"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Payment card number is not valid"/>
        </insert>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id, validation_rule_id)
    			select e1.id + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'cc.number',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				2,
				0,
				e1.id,
				(select max(t.id) from validation_rule t)
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'cc.number' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
				select (select mfn.id), 'PAYMENT_CARD_NUMBER' from meta_field_name mfn WHERE mfn.name = 'cc.number' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')
			from meta_field_name mfn WHERE mfn.name='cc.number'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select max(v.id)+1 from validation_rule v)"/>
            <column name="rule_type" value="REGEX"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id, validation_rule_id)
    			select e1.id + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'cc.expiry.date',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				3,
				0,
				e1.id,
				(select max(t.id) from validation_rule t) from entity e1 
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'cc.expiry.date' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id), 'DATE' from meta_field_name mfn WHERE mfn.name = 'cc.expiry.date' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <insert tableName="validation_rule_attributes">
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="attribute_name" value="regularExpression"/>
            <column name="attribute_value" value="(?:0[1-9]|1[0-2])/[0-9]{4}"/>
        </insert>

        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Expiry date should be in format MM/YYYY"/>
        </insert>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id), (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')
			from meta_field_name mfn WHERE mfn.name='cc.expiry.date'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'cc.gateway.key',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				true,
				false,
				true,
				4,
				0,
				e1.id from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'cc.gateway.key' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),	'GATEWAY_KEY' from meta_field_name mfn WHERE mfn.name='cc.gateway.key' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id), (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')
			from meta_field_name mfn WHERE mfn.name='cc.gateway.key'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'cc.type',
				'PAYMENT_METHOD_TEMPLATE',
				'INTEGER',
				true,
				false,
				true,
				5,
				0,
				e1.id from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'cc.type' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id), 'CC_TYPE' from meta_field_name mfn WHERE mfn.name='cc.type' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'Payment Card')
			from meta_field_name mfn WHERE mfn.name='cc.type'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <!-- 'ACH' payment method template insertions & mappings -->
        <insert tableName="validation_rule">
            <column name="id" valueComputed="(select max(v.id)+1 from validation_rule v)"/>
            <column name="rule_type" value="REGEX"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="validation_rule_attributes">
            <column name="validation_rule_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="attribute_name" value="regularExpression"/>
            <column name="attribute_value" value="[0-9]+"/>
        </insert>

        <insert tableName="international_description">
            <column name="foreign_id" valueComputed="(select max(t.id) from validation_rule t)"/>
            <column name="table_id" valueComputed="(select id from jbilling_table where name='validation_rule')"/>
            <column name="psudo_column" value="errorMessage"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="ABA Routing or Bank Account Number can only be digits"/>
        </insert>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id, validation_rule_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'ach.routing.number',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				1,
				0,
				e1.id,
				(select max(t.id) from validation_rule t)
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'ach.routing.number' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id), 'BANK_ROUTING_NUMBER'
			from meta_field_name mfn WHERE mfn.name='ach.routing.number' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'ACH')
			from meta_field_name mfn WHERE mfn.name='ach.routing.number'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'ach.customer.name',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				2,
				0,
				e1.id
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'ach.customer.name' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),
				'TITLE'
			from meta_field_name mfn WHERE mfn.name='ach.customer.name' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'ACH')
			from meta_field_name mfn WHERE mfn.name='ach.customer.name'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id, validation_rule_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'ach.account.number',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				3,
				0,
				e1.id,
				(select max(t.id) from validation_rule t)
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'ach.account.number' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),
				'BANK_ACCOUNT_NUMBER'
			from meta_field_name mfn WHERE mfn.name='ach.account.number' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'ACH')
			from meta_field_name mfn WHERE mfn.name='ach.account.number'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'ach.bank.name',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				4,
				0,
				e1.id
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'ach.bank.name' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),
				'BANK_NAME'
			from meta_field_name mfn WHERE mfn.name='ach.bank.name' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'ACH')
			from meta_field_name mfn WHERE mfn.name='ach.bank.name'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'ach.account.type',
				'PAYMENT_METHOD_TEMPLATE',
				'ENUMERATION',
				false,
				true,
				true,
				5,
				0,
				e1.id
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'ach.account.type' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),
				'BANK_ACCOUNT_TYPE'
			from meta_field_name mfn WHERE mfn.name='ach.account.type' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'ACH')
			from meta_field_name mfn WHERE mfn.name='ach.account.type'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO enumeration (id, entity_id, name, optlock)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from enumeration t),1),
				e1.id,
				'ach.account.type',
				1
			from entity e1
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO enumeration_values (id, enumeration_id, value, optlock)
    			select (select count(*) from enumeration e2 where enum.id > e2.id and e2.id <> enum.id) + coalesce((select max(t.id)+1 from enumeration_values t),1),
				enum.id,
				'CHECKING',
				1
			from enumeration enum WHERE enum.name='ach.account.type'
			order by enum.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO enumeration_values (id, enumeration_id, value, optlock)
    			select (select count(*) from enumeration e2 where enum.id > e2.id and e2.id <> enum.id) + coalesce((select max(t.id)+1 from enumeration_values t),1),
				enum.id,
				'SAVINGS',
				1
			from enumeration enum WHERE enum.name='ach.account.type'
			order by enum.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'ach.gateway.key',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				true,
				false,
				true,
				6,
				0,
				e1.id
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'ach.gateway.key' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),
				'GATEWAY_KEY'
			from meta_field_name mfn WHERE mfn.name='ach.gateway.key' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'ACH')
			from meta_field_name mfn WHERE mfn.name='ach.gateway.key'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <!-- 'Cheque' payment method template insertions & mappings -->
        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'cheque.bank.name',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				1,
				0,
				e1.id
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'cheque.bank.name' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),
				'BANK_NAME'
			from meta_field_name mfn WHERE mfn.name='cheque.bank.name' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'Cheque')
			from meta_field_name mfn WHERE mfn.name='cheque.bank.name'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'cheque.number',
				'PAYMENT_METHOD_TEMPLATE',
				'STRING',
				false,
				true,
				true,
				2,
				0,
				e1.id
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'cheque.number' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),
				'BANK_NAME'
			from meta_field_name mfn WHERE mfn.name='cheque.number' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'Cheque')
			from meta_field_name mfn WHERE mfn.name='cheque.number'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO meta_field_name (id, name, entity_type, data_type, is_disabled, is_mandatory, is_primary, display_order, optlock, entity_id)
    			select (select count(*) from entity e2 where e1.id > e2.id and e2.id <> e1.id) + coalesce((select max(t.id)+1 from meta_field_name t), 1),
				'cheque.date',
				'PAYMENT_METHOD_TEMPLATE',
				'DATE',
				false,
				true,
				true,
				3,
				0,
				e1.id
			from entity e1
			where e1.id not in (select distinct entity_id from meta_field_name where name = 'cheque.date' and entity_type = 'PAYMENT_METHOD_TEMPLATE')
			order by e1.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO metafield_type_map (metafield_id, field_usage)
			select (select mfn.id),
				'BANK_NAME'
			from meta_field_name mfn WHERE mfn.name='cheque.date' and entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <sql>
            <![CDATA[
			INSERT INTO payment_method_template_meta_fields_map (meta_field_id, method_template_id)
			select (select mfn.id),
				(select min(t.id) from payment_method_template t where t.template_name = 'Cheque')
			from meta_field_name mfn WHERE mfn.name='cheque.date'
			and mfn.id not in (select meta_field_id from payment_method_template_meta_fields_map where method_template_id = (select min(t.id) from payment_method_template t where t.template_name = 'Payment Card'))
			and mfn.entity_type = 'PAYMENT_METHOD_TEMPLATE'
			order by mfn.id
		]]>
        </sql>

        <!-- Moves data from credit_card, payment_info_cheque and ach tables to payment_information_table, also updates foreign keys -->
        <customChange class="com.sapienter.jbilling.server.migrations.MigratePaymentInstruments" />
    </changeSet>

    <changeSet id="#7223 - Preference for enabling JQGrid on the site" author="Nelson Secchi" context="base">
        <comment>Should use JQGrid for tables</comment>
        <insert tableName="preference_type">
            <column name="id" valueNumeric="63"/>
            <column name="def_value" value="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="50"/>
            <column name="foreign_id" valueNumeric="63"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Should use JQGrid for tables"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="50"/>
            <column name="foreign_id" valueNumeric="63"/>
            <column name="psudo_column" value="instruction"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content"
                    value="Set to '0' to use the common layout or set to '1' to use JQGrid on the site's tables"/>
        </insert>

    </changeSet>

    <changeSet id="#8418 - adding currency to commissions" author="Morales Fernando G." context="base">
        <comment>Add currency to commissions</comment>
        <addColumn tableName="partner_commission">
            <column name="currency_id" type="java.sql.Types.INTEGER"/>
        </addColumn>
        <addForeignKeyConstraint constraintName="partner_commission_currency_id_FK"
                                 baseTableName="partner_commission" baseColumnNames="currency_id"
                                 referencedTableName="currency" referencedColumnNames="id"
                />

    </changeSet>

    <changeSet id="#8009-Validation message for lnvalid 'expiry date' field" author="Sagar Dond" context="base">
		<update tableName="international_description">
            <column name="content" value="Expiry date should be in format MM/YYYY"/>
            <where>content = 'Expiry date should be in format MM/yyyy'</where>
        </update>
	</changeSet>
	
	<changeSet id="#6652 - Delete reference of order line tier" author="Ashok Kale" context="base">
		<dropTable tableName="order_line_tier"/>
		<delete tableName="jbilling_seqs">
			<where>name='order_line_tier' </where>
		</delete>
		<delete tableName="jbilling_table">
			<where>name='order_line_tier' </where>
		</delete>
	</changeSet>

    <changeSet id="agent_default_preference" author="Morales Fernando G." context="base">
        <comment>Add Agent commission type preference</comment>
        <insert tableName="preference_type">
            <column name="id" valueNumeric="61"/>
            <column name="def_value" value="INVOICE"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="50"/>
            <column name="foreign_id" valueNumeric="61"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Agent Commission Type"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="50"/>
            <column name="foreign_id" valueNumeric="61"/>
            <column name="psudo_column" value="instruction"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content"
                    value="Defines the default agents' commission type for the entity, one of: INVOICE, PAYMENT"/>
        </insert>
    </changeSet>
    
    <changeSet author="Mahesh Shivarkar" context="base" id="removed-order-line-tier">
		<comment>Removed unused preference for order line tiers i.e. 'Create Invoice Lines based on Order Line Tiers'</comment>
		<delete tableName="international_description">
            <where>table_id = 50 and foreign_id = 56</where>
        </delete>
        <delete tableName="preference">
            <where>type_id = 56</where>
        </delete>
        <delete tableName="preference_type">
            <where>id = 56</where>
        </delete>
    </changeSet>

    <changeSet author="Aman Goel" context="test" id="20141020-#8988-updating MySQL specific plugin parameters"
               dbms="MySQL">
        <comment>Update the SaveToJDBCMediationErrorHandler plugin</comment>
        <sql>
            UPDATE pluggable_task_parameter ptp
            JOIN pluggable_task pt ON pt.id=ptp.task_id
            SET str_value = 'jdbc:mysql://localhost/jbilling_test'
            where ptp.name='url' AND pt.type_id=73
        </sql>
        <sql>
            <![CDATA[
            INSERT INTO pluggable_task_parameter
            (id, float_value, int_value, name, optlock, str_value, task_id)
             select (select max(pp.id)+1 from pluggable_task_parameter pp) + (select count(*) from pluggable_task e2 where pt.id > e2.id and e2.id <> pt.id), NULL, NULL, 'driver', 1, 'com.mysql.jdbc.Driver', pt.id
            from pluggable_task pt where pt.type_id=73 and entity_id=1
            ]]>
        </sql>
        <comment>Update the JDBCReader plugin</comment>
        <sql>
            UPDATE pluggable_task_parameter ptp
            JOIN pluggable_task pt ON pt.id=ptp.task_id
            SET str_value = 'com.mysql.jdbc.Driver'
            where ptp.name='driver' AND pt.type_id=44
        </sql>
        <sql>
            UPDATE pluggable_task_parameter ptp
            JOIN pluggable_task pt ON pt.id=ptp.task_id
            SET str_value = 'jdbc:mysql://localhost/jbilling_test'
            where ptp.name='url' AND pt.type_id=44
        </sql>
    </changeSet>
    
    <changeSet author="Aman Goel" context="base" id="20141104-#10343 - entity_id should not be null">
        <addNotNullConstraint columnDataType="java.sql.Types.INTEGER" columnName="entity_id"
                              tableName="item_type"/>
	</changeSet>

    <changeSet id = "#9958 - different activeSince and activeUntil dates in same PO" author = "Igor Poteryaev"
               context = "base">
        <comment>Add db objects for order line tiers support</comment>

        <addColumn tableName = "order_change">
            <column name = "applied_manually"   type = "java.sql.Types.INTEGER"/>
            <column name = "removal"            type = "java.sql.Types.INTEGER"/>
            <column name = "next_billable_date" type = "java.sql.Types.DATE"/>
            <column name = "end_date"           type = "java.sql.Types.DATE"/>
        </addColumn>

        <addColumn tableName = "order_line">
            <column name = "start_date" type = "java.sql.Types.DATE"/>
            <column name = "end_date"   type = "java.sql.Types.DATE"/>
        </addColumn>

        <createIndex tableName = "order_change" indexName="order_change_idx_order_line">
            <column name="order_line_id" />
        </createIndex>

<!--         <addForeignKeyConstraint constraintName ="order_change_fk_order_line"
                                 baseTableName         = "order_change"
                                 referencedTableName   = "order_line"
                                 baseColumnNames       = "order_line_id"
                                 referencedColumnNames = "id"
                                 deferrable        = "false"
                                 initiallyDeferred = "false"
                                 onDelete = "NO ACTION"
                                 onUpdate = "NO ACTION"/> -->
    </changeSet>
    
    <changeSet id="#10777 - CreditLimitationNotificationTask is missing" author="Juan Vidal" context="base">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                select count(id) from pluggable_task_type where class_name = 'com.sapienter.jbilling.server.user.tasks.CreditLimitationNotificationTask'
            </sqlCheck>
        </preConditions>

        <insert tableName="pluggable_task_type">
            <column name="id" valueComputed="(select max(ptt.id)+1 from pluggable_task_type ptt)"/>
            <column name="category_id" valueNumeric="17"/>
            <column name="class_name" value="com.sapienter.jbilling.server.user.tasks.CreditLimitationNotificationTask"/>
            <column name="min_parameters" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(ptt.id) from pluggable_task_type ptt)"/>
            <column name="psudo_column" value="title"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="User Credit Limitation notification task"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="24"/>
            <column name="foreign_id" valueComputed="(select max(ptt.id) from pluggable_task_type ptt)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="A pluggable task of the type InternalEventsTask to monitor if users pre-paid balance is below a credit limitation 1 or 2 levels and send notifications."/>
        </insert>

        <insert tableName="notification_message_type">
            <column name="id" valueComputed="(select max(nmt.id)+1 from notification_message_type nmt)"/>
            <column name="category_id" valueNumeric="4"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="52"/>
            <column name="foreign_id" valueComputed="(select max(nmt.id) from notification_message_type nmt)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Credit Limitation 1"/>
        </insert>

        <insert tableName="notification_message_type">
            <column name="id" valueComputed="(select max(nmt.id)+1 from notification_message_type nmt)"/>
            <column name="category_id" valueNumeric="4"/>
            <column name="optlock" valueNumeric="0"/>
        </insert>

        <insert tableName="international_description">
            <column name="table_id" valueNumeric="52"/>
            <column name="foreign_id" valueComputed="(select max(nmt.id) from notification_message_type nmt)"/>
            <column name="psudo_column" value="description"/>
            <column name="language_id" valueNumeric="1"/>
            <column name="content" value="Credit Limitation 2"/>
        </insert>

        <update tableName="jbilling_seqs">
            <column name="next_id" valueComputed="(select max(id) from notification_message_type)"/>
            <where>name = 'notification_message_type'</where>
        </update>
    </changeSet>

    <changeSet id="#12343-Update customer data" author="Fernando G. Morales" context="base">
        <comment>Set next_invoice_date value</comment>
        <customChange class="com.sapienter.jbilling.server.migrations.MigrateCustomerNextInvoiceDate" />
    </changeSet>

    <changeSet id="#12343-Update customer test data" author="Fernando G. Morales" context="test">
        <comment>Set next_invoice_date value</comment>
        <customChange class="com.sapienter.jbilling.server.migrations.MigrateCustomerNextInvoiceDate" />
    </changeSet>

</databaseChangeLog>
